{"version":3,"file":"html-overlay-node.es.js","sources":["../src/core/Registry.js","../src/core/Hooks.js","../src/utils/utils.js","../src/core/Node.js","../src/core/Edge.js","../src/groups/GroupManager.js","../src/core/Graph.js","../src/render/hitTest.js","../src/render/CanvasRenderer.js","../src/core/commands.js","../src/core/CommandStack.js","../src/interact/Controller.js","../src/interact/ContextMenu.js","../src/core/Runner.js","../src/render/HtmlOverlay.js","../src/minimap/Minimap.js","../src/ui/PropertyPanel.js","../src/index.js"],"sourcesContent":["// src/core/Registry.js\r\n\r\n/**\r\n * Registry for managing node type definitions\r\n */\r\nexport class Registry {\r\n  constructor() {\r\n    this.types = new Map();\r\n  }\r\n\r\n  /**\r\n   * Register a new node type\r\n   * @param {string} type - Unique type identifier (e.g., \"core/Note\")\r\n   * @param {Object} def - Node definition\r\n   * @param {string} [def.title] - Display title\r\n   * @param {Object} [def.size] - Default size {w, h}\r\n   * @param {Array} [def.inputs] - Input port definitions\r\n   * @param {Array} [def.outputs] - Output port definitions\r\n   * @param {Function} [def.onCreate] - Called when node is created\r\n   * @param {Function} [def.onExecute] - Called each execution cycle\r\n   * @param {Function} [def.onDraw] - Custom drawing function\r\n   * @param {Object} [def.html] - HTML overlay configuration\r\n   * @throws {Error} If type is already registered or invalid\r\n   */\r\n  register(type, def) {\r\n    if (!type || typeof type !== 'string') {\r\n      throw new Error(`Invalid node type: type must be a non-empty string, got ${typeof type}`);\r\n    }\r\n    if (!def || typeof def !== 'object') {\r\n      throw new Error(`Invalid definition for type \"${type}\": definition must be an object`);\r\n    }\r\n    if (this.types.has(type)) {\r\n      throw new Error(`Node type \"${type}\" is already registered. Use unregister() first to replace it.`);\r\n    }\r\n    this.types.set(type, def);\r\n  }\r\n\r\n  /**\r\n   * Unregister a node type\r\n   * @param {string} type - Type identifier to unregister\r\n   * @throws {Error} If type doesn't exist\r\n   */\r\n  unregister(type) {\r\n    if (!this.types.has(type)) {\r\n      throw new Error(`Cannot unregister type \"${type}\": type is not registered`);\r\n    }\r\n    this.types.delete(type);\r\n  }\r\n\r\n  /**\r\n   * Remove all registered node types\r\n   */\r\n  removeAll() {\r\n    this.types.clear();\r\n  }\r\n\r\n  /**\r\n   * Get the definition for a registered node type\r\n   * @param {string} type - Type identifier\r\n   * @returns {Object} Node definition\r\n   * @throws {Error} If type is not registered\r\n   */\r\n  createInstance(type) {\r\n    const def = this.types.get(type);\r\n    if (!def) {\r\n      const available = Array.from(this.types.keys()).join(', ') || 'none';\r\n      throw new Error(`Unknown node type: \"${type}\". Available types: ${available}`);\r\n    }\r\n    return def;\r\n  }\r\n}\r\n","export function createHooks(names) {\r\n  const map = Object.fromEntries(names.map((n) => [n, new Set()]));\r\n  return {\r\n    on(name, fn) {\r\n      map[name].add(fn);\r\n      return () => map[name].delete(fn);\r\n    },\r\n    async emit(name, ...args) {\r\n      for (const fn of map[name]) await fn(...args);\r\n    },\r\n  };\r\n}\r\n","export function randomUUID() {\r\n  // 1) 전역 객체 안전 획득\r\n  const g =\r\n    typeof globalThis !== \"undefined\" ? globalThis :\r\n    typeof self !== \"undefined\" ? self :\r\n    typeof window !== \"undefined\" ? window :\r\n    typeof global !== \"undefined\" ? global : {};\r\n\r\n  const c = g.crypto || g.msCrypto; // IE11 호환\r\n\r\n  // 2) 네이티브 지원 (브라우저/Deno 등)\r\n  if (c && typeof c.randomUUID === \"function\") {\r\n    return c.randomUUID();\r\n  }\r\n\r\n  // 3) Web Crypto만 있는 경우 (getRandomValues로 직접 생성)\r\n  if (c && typeof c.getRandomValues === \"function\") {\r\n    const bytes = new Uint8Array(16);\r\n    c.getRandomValues(bytes);\r\n    // RFC4122 버전/변형 비트 설정\r\n    bytes[6] = (bytes[6] & 0x0f) | 0x40;\r\n    bytes[8] = (bytes[8] & 0x3f) | 0x80;\r\n\r\n    const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, \"0\"));\r\n    return (\r\n      hex.slice(0, 4).join(\"\") + \"-\" +\r\n      hex.slice(4, 6).join(\"\") + \"-\" +\r\n      hex.slice(6, 8).join(\"\") + \"-\" +\r\n      hex.slice(8, 10).join(\"\") + \"-\" +\r\n      hex.slice(10, 16).join(\"\")\r\n    );\r\n  }\r\n\r\n  // 4) Node.js 전용 대체 (require가 있을 때)\r\n  try {\r\n    // 번들러/ESM 충돌 피하려고 런타임에만 require 접근\r\n     \r\n    const req = Function('return typeof require === \"function\" ? require : null')();\r\n    if (req) {\r\n      const nodeCrypto = req(\"crypto\");\r\n      if (typeof nodeCrypto.randomUUID === \"function\") {\r\n        return nodeCrypto.randomUUID();\r\n      }\r\n      const bytes = nodeCrypto.randomBytes(16);\r\n      bytes[6] = (bytes[6] & 0x0f) | 0x40;\r\n      bytes[8] = (bytes[8] & 0x3f) | 0x80;\r\n\r\n      const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, \"0\"));\r\n      return (\r\n        hex.slice(0, 4).join(\"\") + \"-\" +\r\n        hex.slice(4, 6).join(\"\") + \"-\" +\r\n        hex.slice(6, 8).join(\"\") + \"-\" +\r\n        hex.slice(8, 10).join(\"\") + \"-\" +\r\n        hex.slice(10, 16).join(\"\")\r\n      );\r\n    }\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  // 5) 최후의 비보안 대체 (CSPRNG 아님!)\r\n  const bytes = new Uint8Array(16);\r\n  for (let i = 0; i < 16; i++) bytes[i] = Math.floor(Math.random() * 256);\r\n  bytes[6] = (bytes[6] & 0x0f) | 0x40;\r\n  bytes[8] = (bytes[8] & 0x3f) | 0x80;\r\n\r\n  const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, \"0\"));\r\n  return (\r\n    hex.slice(0, 4).join(\"\") + \"-\" +\r\n    hex.slice(4, 6).join(\"\") + \"-\" +\r\n    hex.slice(6, 8).join(\"\") + \"-\" +\r\n    hex.slice(8, 10).join(\"\") + \"-\" +\r\n    hex.slice(10, 16).join(\"\")\r\n  );\r\n}","import { randomUUID } from \"../utils/utils.js\";\r\n\r\n// src/core/Node.js\r\n\r\n/**\r\n * Node represents a single node in the graph\r\n */\r\nexport class Node {\r\n  /**\r\n   * Create a new Node\r\n   * @param {Object} options - Node configuration\r\n   * @param {string} [options.id] - Unique identifier (auto-generated if not provided)\r\n   * @param {string} options.type - Node type identifier\r\n   * @param {string} [options.title] - Display title (defaults to type)\r\n   * @param {number} [options.x=0] - X position\r\n   * @param {number} [options.y=0] - Y position\r\n   * @param {number} [options.width=160] - Node width\r\n   * @param {number} [options.height=60] - Node height\r\n   */\r\n  constructor({ id, type, title, x = 0, y = 0, width = 160, height = 60 }) {\r\n    if (!type) {\r\n      throw new Error(\"Node type is required\");\r\n    }\r\n    this.id = id ?? randomUUID();\r\n    this.type = type;\r\n    this.title = title ?? type;\r\n    this.pos = { x, y };\r\n    this.size = { width, height };\r\n    this.inputs = []; // {id,name,datatype,portType,dir}\r\n    this.outputs = []; // {id,name,datatype,portType,dir}\r\n    this.state = {}; // User state data\r\n\r\n    // Tree Structure\r\n    this.parent = null; // Parent Node (or null if root)\r\n    this.children = new Set(); // Set<Node>\r\n    this.computed = { x: 0, y: 0, w: 0, h: 0 }; // World Transform\r\n  }\r\n\r\n  /**\r\n   * Add an input port to this node\r\n   * @param {string} name - Port name\r\n   * @param {string} [datatype=\"any\"] - Data type for the port\r\n   * @param {string} [portType=\"data\"] - Port type: \"exec\" or \"data\"\r\n   * @returns {Object} The created port\r\n   */\r\n  addInput(name, datatype = \"any\", portType = \"data\") {\r\n    if (!name || typeof name !== \"string\") {\r\n      throw new Error(\"Input port name must be a non-empty string\");\r\n    }\r\n    const port = { id: randomUUID(), name, datatype, portType, dir: \"in\" };\r\n    this.inputs.push(port);\r\n    return port;\r\n  }\r\n\r\n  /**\r\n   * Add an output port to this node\r\n   * @param {string} name - Port name\r\n   * @param {string} [datatype=\"any\"] - Data type for the port\r\n   * @param {string} [portType=\"data\"] - Port type: \"exec\" or \"data\"\r\n   * @returns {Object} The created port\r\n   */\r\n  addOutput(name, datatype = \"any\", portType = \"data\") {\r\n    if (!name || typeof name !== \"string\") {\r\n      throw new Error(\"Output port name must be a non-empty string\");\r\n    }\r\n    const port = { id: randomUUID(), name, datatype, portType, dir: \"out\" };\r\n    this.outputs.push(port);\r\n    return port;\r\n  }\r\n}\r\n","import { randomUUID } from \"../utils/utils.js\";\r\n\r\n// src/core/Edge.js\r\n\r\n/**\r\n * Edge represents a connection between two node ports\r\n */\r\nexport class Edge {\r\n  /**\r\n   * Create a new Edge\r\n   * @param {Object} options - Edge configuration\r\n   * @param {string} [options.id] - Unique identifier (auto-generated if not provided)\r\n   * @param {string} options.fromNode - Source node ID\r\n   * @param {string} options.fromPort - Source port ID\r\n   * @param {string} options.toNode - Target node ID\r\n   * @param {string} options.toPort - Target port ID\r\n   */\r\n  constructor({ id, fromNode, fromPort, toNode, toPort }) {\r\n    if (!fromNode || !fromPort || !toNode || !toPort) {\r\n      throw new Error(\"Edge requires fromNode, fromPort, toNode, and toPort\");\r\n    }\r\n    this.id = id ?? randomUUID();\r\n    this.fromNode = fromNode;\r\n    this.fromPort = fromPort;\r\n    this.toNode = toNode;\r\n    this.toPort = toPort;\r\n  }\r\n}\r\n","// src/groups/GroupManager.js\r\n\r\n\r\nexport class GroupManager {\r\n  constructor({ graph, hooks }) {\r\n    this.graph = graph;\r\n    this.hooks = hooks;\r\n    this._groups = [];\r\n  }\r\n\r\n  // ---------- CRUD ----------\r\n  addGroup({\r\n    title = \"Group\",\r\n    x = 0,\r\n    y = 0,\r\n    width = 240,\r\n    height = 160,\r\n    color = \"#39424e\",\r\n    members = [],\r\n  } = {}) {\r\n    // Validate parameters\r\n    if (width < 100 || height < 60) {\r\n      console.warn(\"Group size too small, using minimum size\");\r\n      width = Math.max(100, width);\r\n      height = Math.max(60, height);\r\n    }\r\n\r\n    const groupNode = this.graph.addNode(\"core/Group\", {\r\n      title,\r\n      x,\r\n      y,\r\n      width,\r\n      height,\r\n    });\r\n    groupNode.state.color = color;\r\n\r\n    // Reparent members with validation\r\n    for (const memberId of members) {\r\n      const node = this.graph.getNodeById(memberId);\r\n      if (node) {\r\n        if (node.type === \"core/Group\") {\r\n          console.warn(`Cannot add group ${memberId} as member of another group`);\r\n          continue;\r\n        }\r\n        this.graph.reparent(node, groupNode);\r\n      } else {\r\n        console.warn(`Member node ${memberId} not found, skipping`);\r\n      }\r\n    }\r\n\r\n    this._groups.push(groupNode);\r\n    this.hooks?.emit(\"group:change\");\r\n    return groupNode;\r\n  }\r\n\r\n  addGroupFromSelection({ title = \"Group\", margin = { x: 12, y: 12 } } = {}) {\r\n    // Controller에서 selection을 받아와야 함\r\n    // 여기서는 간단히 graph.nodes를 순회하며 selected 상태를 확인한다고 가정하거나\r\n    // 외부에서 members를 넘겨받는 것이 좋음\r\n    // 일단은 외부에서 members를 넘겨받는 addGroup을 활용.\r\n    return null;\r\n  }\r\n\r\n  removeGroup(id) {\r\n    const groupNode = this.graph.getNodeById(id);\r\n    if (!groupNode || groupNode.type !== \"core/Group\") return;\r\n\r\n    // Ungroup: reparent children to group's parent\r\n    const children = [...groupNode.children];\r\n    for (const child of children) {\r\n      this.graph.reparent(child, groupNode.parent);\r\n    }\r\n\r\n    this.graph.removeNode(id);\r\n    this.hooks?.emit(\"group:change\");\r\n  }\r\n\r\n  // ---------- 이동/리사이즈 ----------\r\n  // 이제 Node의 이동/리사이즈 로직을 따름.\r\n  // Controller에서 Node 이동 시 updateWorldTransforms가 호출되므로 자동 처리됨.\r\n\r\n  resizeGroup(id, dw, dh) {\r\n    const g = this.graph.getNodeById(id);\r\n    if (!g || g.type !== \"core/Group\") return;\r\n\r\n    const minW = 100;\r\n    const minH = 60;\r\n    g.size.width = Math.max(minW, g.size.width + dw);\r\n    g.size.height = Math.max(minH, g.size.height + dh);\r\n\r\n    this.graph.updateWorldTransforms();\r\n    this.hooks?.emit(\"group:change\");\r\n  }\r\n\r\n  // ---------- 히트테스트 & 드래그 ----------\r\n  // 이제 Group도 Node이므로 Controller의 Node 히트테스트 로직을 따름.\r\n  // 단, Resize Handle은 별도 처리가 필요할 수 있음.\r\n\r\n  hitTestResizeHandle(x, y) {\r\n    const handleSize = 10;\r\n    // 역순 순회 (위에 있는 것부터)\r\n    const nodes = [...this.graph.nodes.values()].reverse();\r\n\r\n    for (const node of nodes) {\r\n      if (node.type !== \"core/Group\") continue;\r\n\r\n      // World Transform 사용\r\n      const { x: gx, y: gy, w: gw, h: gh } = node.computed;\r\n\r\n      if (x >= gx + gw - handleSize && x <= gx + gw && y >= gy + gh - handleSize && y <= gy + gh) {\r\n        return { group: node, handle: \"se\" };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { Node } from \"./Node.js\";\r\nimport { Edge } from \"./Edge.js\";\r\nimport { GroupManager } from \"../groups/GroupManager.js\";\r\n\r\n/**\r\n * Graph manages the collection of nodes and edges\r\n */\r\nexport class Graph {\r\n  /**\r\n   * Create a new Graph\r\n   * @param {Object} options - Graph configuration\r\n   * @param {Object} options.hooks - Event hooks system\r\n   * @param {Object} options.registry - Node type registry\r\n   */\r\n  constructor({ hooks, registry }) {\r\n    if (!registry) {\r\n      throw new Error(\"Graph requires a registry\");\r\n    }\r\n    this.nodes = new Map();\r\n    this.edges = new Map();\r\n    this.hooks = hooks;\r\n    this.registry = registry;\r\n    // double buffer for deterministic cycles\r\n    this._valuesA = new Map(); // current\r\n    this._valuesB = new Map(); // next\r\n    this._useAasCurrent = true;\r\n\r\n    this.groupManager = new GroupManager({\r\n      graph: this,\r\n      hooks: this.hooks,\r\n    });\r\n  }\r\n  /**\r\n   * Get a node by its ID\r\n   * @param {string} id - Node ID\r\n   * @returns {Node|null} The node or null if not found\r\n   */\r\n  getNodeById(id) {\r\n    return this.nodes.get(id) || null;\r\n  }\r\n  /**\r\n   * Add a node to the graph\r\n   * @param {string} type - Node type identifier\r\n   * @param {Object} [opts={}] - Additional node options (x, y, width, height, etc.)\r\n   * @returns {Node} The created node\r\n   * @throws {Error} If node type is not registered\r\n   */\r\n  addNode(type, opts = {}) {\r\n    const def = this.registry.types.get(type);\r\n    if (!def) {\r\n      const available = Array.from(this.registry.types.keys()).join(\", \") || \"none\";\r\n      throw new Error(`Unknown node type: \"${type}\". Available types: ${available}`);\r\n    }\r\n    const node = new Node({\r\n      type,\r\n      title: def.title,\r\n      width: def.size?.w,\r\n      height: def.size?.h,\r\n      ...opts,\r\n    });\r\n    for (const i of def.inputs || []) node.addInput(i.name, i.datatype, i.portType || \"data\");\r\n    for (const o of def.outputs || []) node.addOutput(o.name, o.datatype, o.portType || \"data\");\r\n    def.onCreate?.(node);\r\n    this.nodes.set(node.id, node);\r\n    this.hooks?.emit(\"node:create\", node);\r\n    return node;\r\n  }\r\n  /**\r\n   * Remove a node and its connected edges from the graph\r\n   * @param {string} nodeId - ID of the node to remove\r\n   */\r\n  removeNode(nodeId) {\r\n    // Remove all edges connected to this node\r\n    for (const [eid, e] of this.edges) {\r\n      if (e.fromNode === nodeId || e.toNode === nodeId) {\r\n        this.edges.delete(eid);\r\n      }\r\n    }\r\n    this.nodes.delete(nodeId);\r\n  }\r\n  /**\r\n   * Add an edge connecting two node ports\r\n   * @param {string} fromNode - Source node ID\r\n   * @param {string} fromPort - Source port ID\r\n   * @param {string} toNode - Target node ID\r\n   * @param {string} toPort - Target port ID\r\n   * @returns {Edge} The created edge\r\n   * @throws {Error} If nodes don't exist\r\n   */\r\n  addEdge(fromNode, fromPort, toNode, toPort) {\r\n    // Validate nodes exist\r\n    if (!this.nodes.has(fromNode)) {\r\n      throw new Error(`Cannot create edge: source node \"${fromNode}\" not found`);\r\n    }\r\n    if (!this.nodes.has(toNode)) {\r\n      throw new Error(`Cannot create edge: target node \"${toNode}\" not found`);\r\n    }\r\n\r\n    const e = new Edge({ fromNode, fromPort, toNode, toPort });\r\n    this.edges.set(e.id, e);\r\n    this.hooks?.emit(\"edge:create\", e);\r\n    return e;\r\n  }\r\n\r\n  /**\r\n   * Clear all nodes and edges from the graph\r\n   */\r\n  clear() {\r\n    this.nodes.clear();\r\n    this.edges.clear();\r\n  }\r\n\r\n  updateWorldTransforms() {\r\n    // 1. Find roots\r\n    const roots = [];\r\n    for (const n of this.nodes.values()) {\r\n      if (!n.parent) roots.push(n);\r\n    }\r\n\r\n    // 2. Traverse\r\n    const stack = roots.map((n) => ({ node: n, px: 0, py: 0 }));\r\n    while (stack.length > 0) {\r\n      const { node, px, py } = stack.pop();\r\n      node.computed.x = px + node.pos.x;\r\n      node.computed.y = py + node.pos.y;\r\n      node.computed.w = node.size.width;\r\n      node.computed.h = node.size.height;\r\n\r\n      for (const child of node.children) {\r\n        stack.push({ node: child, px: node.computed.x, py: node.computed.y });\r\n      }\r\n    }\r\n  }\r\n\r\n  reparent(node, newParent) {\r\n    if (node.parent === newParent) return;\r\n\r\n    // 1. Calculate current world pos\r\n    const wx = node.computed.x;\r\n    const wy = node.computed.y;\r\n\r\n    // 2. Remove from old parent\r\n    if (node.parent) {\r\n      node.parent.children.delete(node);\r\n    }\r\n\r\n    // 3. Add to new parent\r\n    node.parent = newParent;\r\n    if (newParent) {\r\n      newParent.children.add(node);\r\n      // 4. Calculate new local pos\r\n      // world = parentWorld + local => local = world - parentWorld\r\n      node.pos.x = wx - newParent.computed.x;\r\n      node.pos.y = wy - newParent.computed.y;\r\n    } else {\r\n      // Root\r\n      node.pos.x = wx;\r\n      node.pos.y = wy;\r\n    }\r\n\r\n    this.updateWorldTransforms();\r\n  }\r\n\r\n  // buffer helpers\r\n  _curBuf() {\r\n    return this._useAasCurrent ? this._valuesA : this._valuesB;\r\n  }\r\n  _nextBuf() {\r\n    return this._useAasCurrent ? this._valuesB : this._valuesA;\r\n  }\r\n  swapBuffers() {\r\n    // when moving to next cycle, promote next->current and clear next\r\n    this._useAasCurrent = !this._useAasCurrent;\r\n    this._nextBuf().clear();\r\n  }\r\n  // data helpers\r\n  setOutput(nodeId, portId, value) {\r\n    console.log(`[Graph.setOutput] nodeId: ${nodeId}, portId: ${portId}, value:`, value);\r\n    const key = `${nodeId}:${portId}`;\r\n    this._nextBuf().set(key, value);\r\n  }\r\n  getInput(nodeId, portId) {\r\n    // Find incoming edge to this port\r\n    for (const edge of this.edges.values()) {\r\n      if (edge.toNode === nodeId && edge.toPort === portId) {\r\n        const key = `${edge.fromNode}:${edge.fromPort}`;\r\n        const value = this._curBuf().get(key);\r\n        console.log(`[Graph.getInput] nodeId: ${nodeId}, portId: ${portId}, reading from ${edge.fromNode}:${edge.fromPort}, value:`, value);\r\n        return value;\r\n      }\r\n    }\r\n    console.log(`[Graph.getInput] nodeId: ${nodeId}, portId: ${portId}, no edge found, returning undefined`);\r\n    return undefined;\r\n  }\r\n  toJSON() {\r\n    const json = {\r\n      nodes: [...this.nodes.values()].map((n) => ({\r\n        id: n.id,\r\n        type: n.type,\r\n        title: n.title,\r\n        x: n.pos.x,\r\n        y: n.pos.y,\r\n        w: n.size.width,\r\n        h: n.size.height,\r\n        inputs: n.inputs,\r\n        outputs: n.outputs,\r\n        state: n.state,\r\n        parentId: n.parent?.id || null, // Save parent relationship\r\n      })),\r\n      edges: [...this.edges.values()],\r\n    };\r\n    this.hooks?.emit(\"graph:serialize\", json);\r\n    return json;\r\n  }\r\n  fromJSON(json) {\r\n    this.clear();\r\n\r\n    // Restore nodes first\r\n    for (const nd of json.nodes) {\r\n      const node = new Node({\r\n        id: nd.id,\r\n        type: nd.type,\r\n        title: nd.title,\r\n        x: nd.x,\r\n        y: nd.y,\r\n        width: nd.w,\r\n        height: nd.h,\r\n      });\r\n      // Call onCreate to initialize node with defaults first\r\n      const def = this.registry?.types?.get(nd.type);\r\n      if (def?.onCreate) {\r\n        def.onCreate(node);\r\n      }\r\n\r\n      node.inputs = nd.inputs;\r\n      node.outputs = nd.outputs;\r\n      // Merge loaded state over defaults\r\n      node.state = { ...node.state, ...(nd.state || {}) };\r\n\r\n      this.nodes.set(node.id, node);\r\n    }\r\n\r\n    // Restore parent-child relationships\r\n    for (const nd of json.nodes) {\r\n      if (nd.parentId) {\r\n        const node = this.nodes.get(nd.id);\r\n        const parent = this.nodes.get(nd.parentId);\r\n        if (node && parent) {\r\n          node.parent = parent;\r\n          parent.children.add(node);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Restore edges\r\n    for (const ed of json.edges) {\r\n      this.edges.set(ed.id, new Edge(ed));\r\n    }\r\n\r\n    // Update world transforms to calculate proper positions\r\n    this.updateWorldTransforms();\r\n\r\n    this.hooks?.emit(\"graph:deserialize\", json);\r\n\r\n    return this;\r\n  }\r\n}\r\n","// src/render/hitTest.js\r\nexport function hitTestNode(node, x, y) {\r\n  const { x: nx, y: ny, w: width, h: height } = node.computed || {\r\n    x: node.pos.x,\r\n    y: node.pos.y,\r\n    w: node.size.width,\r\n    h: node.size.height,\r\n  };\r\n  return x >= nx && x <= nx + width && y >= ny && y <= ny + height;\r\n}\r\n\r\nexport function portRect(node, port, idx, dir) {\r\n  const { x: nx, y: ny, w: width, h: height } = node.computed || {\r\n    x: node.pos.x,\r\n    y: node.pos.y,\r\n    w: node.size.width,\r\n    h: node.size.height,\r\n  };\r\n\r\n  // Calculate port count for better spacing\r\n  const portCount = dir === \"in\" ? node.inputs.length : node.outputs.length;\r\n  const headerHeight = 28;\r\n  const availableHeight = (height || node.size.height) - headerHeight - 16;\r\n  const spacing = availableHeight / (portCount + 1);\r\n\r\n  const y = ny + headerHeight + spacing * (idx + 1);\r\n\r\n  // Ports centered on node edges (half inside, half outside)\r\n  const portWidth = 12;\r\n  const portHeight = 12;\r\n\r\n  if (dir === \"in\") {\r\n    return { x: nx - portWidth / 2, y: y - portHeight / 2, w: portWidth, h: portHeight };\r\n  }\r\n  if (dir === \"out\") {\r\n    return { x: nx + width - portWidth / 2, y: y - portHeight / 2, w: portWidth, h: portHeight };\r\n  }\r\n}\r\n","import { hitTestNode, portRect } from \"./hitTest.js\";\r\n\r\nexport class CanvasRenderer {\r\n  static FONT_SIZE = 12;\r\n  static SELECTED_NODE_COLOR = \"#6cf\";\r\n  constructor(canvas, { theme = {}, registry, edgeStyle = \"orthogonal\" } = {}) {\r\n    this.canvas = canvas;\r\n    this.ctx = canvas.getContext(\"2d\");\r\n    this.registry = registry; // to call per-node onDraw\r\n\r\n    // viewport transform\r\n    this.scale = 1;\r\n    this.minScale = 0.25;\r\n    this.maxScale = 3;\r\n    this.offsetX = 0;\r\n    this.offsetY = 0;\r\n\r\n    // 'bezier' | 'line' | 'orthogonal'\r\n    this.edgeStyle = edgeStyle;\r\n\r\n    this.theme = Object.assign(\r\n      {\r\n        bg: \"#0d0d0f\",           // Darker background\r\n        grid: \"#1a1a1d\",         // Subtle grid\r\n        node: \"#16161a\",         // Darker nodes\r\n        nodeBorder: \"#2a2a2f\",   // Subtle border\r\n        title: \"#1f1f24\",        // Darker header\r\n        text: \"#e4e4e7\",         // Softer white\r\n        textMuted: \"#a1a1aa\",    // Muted text\r\n        port: \"#6366f1\",         // Indigo for data ports\r\n        portExec: \"#10b981\",     // Emerald for exec ports\r\n        edge: \"#52525b\",         // Neutral edge color\r\n        edgeActive: \"#8b5cf6\",   // Purple for active\r\n        accent: \"#6366f1\",       // Indigo accent\r\n        accentBright: \"#818cf8\", // Brighter accent\r\n      },\r\n      theme\r\n    );\r\n  }\r\n  setEdgeStyle(style) {\r\n    this.edgeStyle =\r\n      style === \"line\" || style === \"orthogonal\" ? style : \"bezier\";\r\n  }\r\n  setRegistry(reg) {\r\n    this.registry = reg;\r\n  }\r\n  resize(w, h) {\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n  }\r\n  setTransform({\r\n    scale = this.scale,\r\n    offsetX = this.offsetX,\r\n    offsetY = this.offsetY,\r\n  } = {}) {\r\n    this.scale = Math.min(this.maxScale, Math.max(this.minScale, scale));\r\n    this.offsetX = offsetX;\r\n    this.offsetY = offsetY;\r\n  }\r\n  panBy(dx, dy) {\r\n    this.offsetX += dx;\r\n    this.offsetY += dy;\r\n  }\r\n  zoomAt(factor, cx, cy) {\r\n    // factor > 1 zoom in, < 1 zoom out, centered at screen point (cx, cy)\r\n    const prev = this.scale;\r\n    const next = Math.min(\r\n      this.maxScale,\r\n      Math.max(this.minScale, prev * factor)\r\n    );\r\n    if (next === prev) return;\r\n    // keep the world point under cursor fixed: adjust offset\r\n    const wx = (cx - this.offsetX) / prev;\r\n    const wy = (cy - this.offsetY) / prev;\r\n    this.offsetX = cx - wx * next;\r\n    this.offsetY = cy - wy * next;\r\n    this.scale = next;\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return {\r\n      x: (x - this.offsetX) / this.scale,\r\n      y: (y - this.offsetY) / this.scale,\r\n    };\r\n  }\r\n  worldToScreen(x, y) {\r\n    return {\r\n      x: x * this.scale + this.offsetX,\r\n      y: y * this.scale + this.offsetY,\r\n    };\r\n  }\r\n  _applyTransform() {\r\n    const { ctx } = this;\r\n    ctx.setTransform(this.scale, 0, 0, this.scale, this.offsetX, this.offsetY);\r\n  }\r\n  _resetTransform() {\r\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n  }\r\n\r\n  // ── Drawing ────────────────────────────────────────────────────────────────\r\n  _drawArrowhead(x1, y1, x2, y2, size = 10) {\r\n    const { ctx } = this;\r\n    const s = size / this.scale; // 줌에 따라 크기 보정\r\n    const ang = Math.atan2(y2 - y1, x2 - x1);\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x2, y2);\r\n    ctx.lineTo(\r\n      x2 - s * Math.cos(ang - Math.PI / 6),\r\n      y2 - s * Math.sin(ang - Math.PI / 6)\r\n    );\r\n    ctx.lineTo(\r\n      x2 - s * Math.cos(ang + Math.PI / 6),\r\n      y2 - s * Math.sin(ang + Math.PI / 6)\r\n    );\r\n    ctx.closePath();\r\n    ctx.fill(); // 선 색상과 동일한 fill이 자연스러움\r\n  }\r\n\r\n  _drawScreenText(\r\n    text,\r\n    lx,\r\n    ly,\r\n    {\r\n      fontPx = 12,\r\n      color = this.theme.text,\r\n      align = \"left\",\r\n      baseline = \"alphabetic\",\r\n      dpr = 1, // 추후 devicePixelRatio 도입\r\n    } = {}\r\n  ) {\r\n    const { ctx } = this;\r\n    const { x: sx, y: sy } = this.worldToScreen(lx, ly);\r\n\r\n    ctx.save();\r\n    // 화면 좌표계(스케일=1)로 리셋\r\n    this._resetTransform();\r\n\r\n    // 픽셀 스냅(번짐 방지)\r\n    const px = Math.round(sx) + 0.5;\r\n    const py = Math.round(sy) + 0.5;\r\n\r\n    ctx.font = `${fontPx * this.scale}px system-ui`;\r\n    ctx.fillStyle = color;\r\n    ctx.textAlign = align;\r\n    ctx.textBaseline = baseline;\r\n    ctx.fillText(text, px, py);\r\n    ctx.restore();\r\n  }\r\n\r\n  drawGrid() {\r\n    const { ctx, canvas, theme, scale, offsetX, offsetY } = this;\r\n    // clear screen in screen space\r\n\r\n    this._resetTransform();\r\n    ctx.fillStyle = theme.bg;\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // draw grid in world space so it pans/zooms\r\n    this._applyTransform();\r\n    // Make grid subtle but visible\r\n    ctx.strokeStyle = this._rgba(theme.grid, 0.35); // Subtle but visible\r\n    ctx.lineWidth = 1 / scale; // keep 1px apparent\r\n\r\n    const base = 20; // world units\r\n    const step = base;\r\n\r\n    // visible world bounds\r\n    const x0 = -offsetX / scale;\r\n    const y0 = -offsetY / scale;\r\n    const x1 = (canvas.width - offsetX) / scale;\r\n    const y1 = (canvas.height - offsetY) / scale;\r\n\r\n    const startX = Math.floor(x0 / step) * step;\r\n    const startY = Math.floor(y0 / step) * step;\r\n\r\n    ctx.beginPath();\r\n    for (let x = startX; x <= x1; x += step) {\r\n      ctx.moveTo(x, y0);\r\n      ctx.lineTo(x, y1);\r\n    }\r\n    for (let y = startY; y <= y1; y += step) {\r\n      ctx.moveTo(x0, y);\r\n      ctx.lineTo(x1, y);\r\n    }\r\n    ctx.stroke();\r\n\r\n    this._resetTransform();\r\n  }\r\n\r\n  draw(\r\n    graph,\r\n    {\r\n      selection = new Set(),\r\n      tempEdge = null,\r\n      running = false,\r\n      time = performance.now(),\r\n      dt = 0,\r\n      groups = null,\r\n      activeEdges = new Set(),\r\n    } = {}\r\n  ) {\r\n    // Update transforms first\r\n    graph.updateWorldTransforms();\r\n\r\n    this.drawGrid();\r\n    const { ctx, theme } = this;\r\n    this._applyTransform();\r\n\r\n    ctx.save();\r\n\r\n    // 1. Draw Groups (Backgrounds)\r\n    for (const n of graph.nodes.values()) {\r\n      if (n.type === \"core/Group\") {\r\n        const sel = selection.has(n.id);\r\n        const def = this.registry?.types?.get(n.type);\r\n        if (def?.onDraw) def.onDraw(n, { ctx, theme });\r\n        else this._drawNode(n, sel);\r\n      }\r\n    }\r\n\r\n    // 2. Draw Edges (BEFORE nodes so ports appear on top)\r\n    ctx.lineWidth = 1.5 / this.scale; // Thinner, more refined edges\r\n\r\n    // Calculate animation values if running\r\n    let dashArray = null;\r\n    let dashOffset = 0;\r\n    if (running) {\r\n      const speed = 120;\r\n      const phase = (((time / 1000) * speed) / this.scale) % CanvasRenderer.FONT_SIZE;\r\n      dashArray = [6 / this.scale, 6 / this.scale];\r\n      dashOffset = -phase;\r\n    }\r\n\r\n    for (const e of graph.edges.values()) {\r\n      const shouldAnimate = activeEdges && activeEdges.size > 0 && activeEdges.has(e.id);\r\n\r\n      if (running && shouldAnimate && dashArray) {\r\n        ctx.setLineDash(dashArray);\r\n        ctx.lineDashOffset = dashOffset;\r\n      } else {\r\n        ctx.setLineDash([]);\r\n        ctx.lineDashOffset = 0;\r\n      }\r\n\r\n      const isActive = activeEdges && activeEdges.has(e.id);\r\n      if (isActive) {\r\n        ctx.strokeStyle = \"#00ffff\";\r\n        ctx.lineWidth = 3 * this.scale;\r\n      } else {\r\n        ctx.strokeStyle = theme.edge;\r\n        ctx.lineWidth = 1.5 / this.scale;\r\n      }\r\n      this._drawEdge(graph, e);\r\n    }\r\n\r\n    // temp edge preview\r\n    if (tempEdge) {\r\n      const a = this.screenToWorld(tempEdge.x1, tempEdge.y1);\r\n      const b = this.screenToWorld(tempEdge.x2, tempEdge.y2);\r\n\r\n      const prevDash = this.ctx.getLineDash();\r\n      this.ctx.setLineDash([6 / this.scale, 6 / this.scale]);\r\n\r\n      let ptsForArrow = null;\r\n      if (this.edgeStyle === \"line\") {\r\n        this._drawLine(a.x, a.y, b.x, b.y);\r\n        ptsForArrow = [{ x: a.x, y: a.y }, { x: b.x, y: b.y }];\r\n      } else if (this.edgeStyle === \"orthogonal\") {\r\n        ptsForArrow = this._drawOrthogonal(a.x, a.y, b.x, b.y);\r\n      } else {\r\n        this._drawCurve(a.x, a.y, b.x, b.y);\r\n        ptsForArrow = [{ x: a.x, y: a.y }, { x: b.x, y: b.y }];\r\n      }\r\n\r\n      this.ctx.setLineDash(prevDash);\r\n\r\n      if (ptsForArrow && ptsForArrow.length >= 2) {\r\n        const p1 = ptsForArrow[ptsForArrow.length - 2];\r\n        const p2 = ptsForArrow[ptsForArrow.length - 1];\r\n        this.ctx.fillStyle = this.theme.edge;\r\n        this.ctx.strokeStyle = this.theme.edge;\r\n        this._drawArrowhead(p1.x, p1.y, p2.x, p2.y, 12);\r\n      }\r\n    }\r\n\r\n    // 3. Draw Other Nodes (AFTER edges)\r\n    // For nodes with HTML overlays, skip ports initially\r\n    for (const n of graph.nodes.values()) {\r\n      if (n.type !== \"core/Group\") {\r\n        const sel = selection.has(n.id);\r\n        const def = this.registry?.types?.get(n.type);\r\n        const hasHtmlOverlay = !!(def?.html);\r\n\r\n        // Draw node, but skip ports if it has HTML overlay\r\n        this._drawNode(n, sel, hasHtmlOverlay);\r\n        if (def?.onDraw) def.onDraw(n, { ctx, theme });\r\n      }\r\n    }\r\n\r\n    // 4. Draw ports for HTML overlay nodes LAST (so they appear above HTML)\r\n    for (const n of graph.nodes.values()) {\r\n      if (n.type !== \"core/Group\") {\r\n        const def = this.registry?.types?.get(n.type);\r\n        const hasHtmlOverlay = !!(def?.html);\r\n\r\n        if (hasHtmlOverlay) {\r\n          this._drawPorts(n);\r\n        }\r\n      }\r\n    }\r\n\r\n    this._resetTransform();\r\n  }\r\n\r\n  _rgba(hex, a) {\r\n    const c = hex.replace(\"#\", \"\");\r\n    const n = parseInt(\r\n      c.length === 3\r\n        ? c\r\n          .split(\"\")\r\n          .map((x) => x + x)\r\n          .join(\"\")\r\n        : c,\r\n      16\r\n    );\r\n    const r = (n >> 16) & 255,\r\n      g = (n >> 8) & 255,\r\n      b = n & 255;\r\n    return `rgba(${r},${g},${b},${a})`;\r\n  }\r\n\r\n  _drawNode(node, selected, skipPorts = false) {\r\n    const { ctx, theme } = this;\r\n    const r = 8;\r\n    const { x, y, w, h } = node.computed;\r\n\r\n    // Draw subtle shadow\r\n    if (!selected) {\r\n      ctx.save();\r\n      ctx.shadowColor = \"rgba(0, 0, 0, 0.3)\";\r\n      ctx.shadowBlur = 8 / this.scale;\r\n      ctx.shadowOffsetY = 2 / this.scale;\r\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.2)\";\r\n      roundRect(ctx, x, y, w, h, r);\r\n      ctx.fill();\r\n      ctx.restore();\r\n    }\r\n\r\n    // Draw main body\r\n    ctx.fillStyle = theme.node;\r\n    ctx.strokeStyle = selected ? theme.accentBright : theme.nodeBorder;\r\n    ctx.lineWidth = (selected ? 1.5 : 1) / this.scale;\r\n    roundRect(ctx, x, y, w, h, r);\r\n    ctx.fill();\r\n    ctx.stroke();\r\n\r\n    // Draw header\r\n    ctx.fillStyle = theme.title;\r\n    roundRect(ctx, x, y, w, 24, { tl: r, tr: r, br: 0, bl: 0 });\r\n    ctx.fill();\r\n\r\n    // Header border (only top and sides)\r\n    ctx.strokeStyle = selected ? theme.accentBright : theme.nodeBorder;\r\n    ctx.lineWidth = (selected ? 1.5 : 1) / this.scale;\r\n    ctx.beginPath();\r\n    // Top-left corner to top-right corner\r\n    ctx.moveTo(x + r, y);\r\n    ctx.lineTo(x + w - r, y);\r\n    ctx.quadraticCurveTo(x + w, y, x + w, y + r);\r\n    // Right side down to header bottom\r\n    ctx.lineTo(x + w, y + 24);\r\n    // Move to left side header bottom\r\n    ctx.moveTo(x, y + 24);\r\n    // Left side up to top-left corner\r\n    ctx.lineTo(x, y + r);\r\n    ctx.quadraticCurveTo(x, y, x + r, y);\r\n    ctx.stroke();\r\n\r\n    this._drawScreenText(node.title, x + 8, y + CanvasRenderer.FONT_SIZE, {\r\n      fontPx: CanvasRenderer.FONT_SIZE,\r\n      color: theme.text,\r\n      baseline: \"middle\",\r\n      align: \"left\",\r\n    });\r\n\r\n    // Skip port drawing if requested (for HTML overlay nodes)\r\n    if (skipPorts) return;\r\n\r\n    // Draw input ports\r\n    node.inputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"in\");\r\n      const cx = rct.x + rct.w / 2;\r\n      const cy = rct.y + rct.h / 2;\r\n\r\n      if (p.portType === \"exec\") {\r\n        // Draw exec port - rounded square\r\n        const portSize = 8;\r\n        ctx.fillStyle = theme.portExec;\r\n        ctx.strokeStyle = \"rgba(16, 185, 129, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.roundRect(cx - portSize / 2, cy - portSize / 2, portSize, portSize, 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      } else {\r\n        // Draw data port - circle with outline\r\n        ctx.fillStyle = theme.port;\r\n        ctx.strokeStyle = \"rgba(99, 102, 241, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.arc(cx, cy, 5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      }\r\n    });\r\n\r\n    // Draw output ports\r\n    node.outputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"out\");\r\n      const cx = rct.x + rct.w / 2;\r\n      const cy = rct.y + rct.h / 2;\r\n\r\n      if (p.portType === \"exec\") {\r\n        // Draw exec port - rounded square\r\n        const portSize = 8;\r\n        ctx.fillStyle = theme.portExec;\r\n        ctx.strokeStyle = \"rgba(16, 185, 129, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.roundRect(cx - portSize / 2, cy - portSize / 2, portSize, portSize, 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      } else {\r\n        // Draw data port - circle with outline\r\n        ctx.fillStyle = theme.port;\r\n        ctx.strokeStyle = \"rgba(99, 102, 241, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.arc(cx, cy, 5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      }\r\n    });\r\n  }\r\n\r\n  _drawPorts(node) {\r\n    const { ctx, theme } = this;\r\n\r\n    // Draw input ports\r\n    node.inputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"in\");\r\n      const cx = rct.x + rct.w / 2;\r\n      const cy = rct.y + rct.h / 2;\r\n\r\n      if (p.portType === \"exec\") {\r\n        // Draw exec port - rounded square with subtle glow\r\n        const portSize = 8;\r\n        ctx.fillStyle = theme.portExec;\r\n        ctx.strokeStyle = \"rgba(16, 185, 129, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.roundRect(cx - portSize / 2, cy - portSize / 2, portSize, portSize, 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      } else {\r\n        // Draw data port - circle with subtle outline\r\n        ctx.fillStyle = theme.port;\r\n        ctx.strokeStyle = \"rgba(99, 102, 241, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.arc(cx, cy, 5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n      }\r\n    });\r\n\r\n    // Draw output ports\r\n    node.outputs.forEach((p, i) => {\r\n      const rct = portRect(node, p, i, \"out\");\r\n      const cx = rct.x + rct.w / 2;\r\n      const cy = rct.y + rct.h / 2;\r\n\r\n      if (p.portType === \"exec\") {\r\n        // Draw exec port - rounded square\r\n        const portSize = 8;\r\n        ctx.fillStyle = theme.portExec;\r\n        ctx.strokeStyle = \"rgba(16, 185, 129, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.roundRect(cx - portSize / 2, cy - portSize / 2, portSize, portSize, 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      } else {\r\n        // Draw data port - circle with outline\r\n        ctx.fillStyle = theme.port;\r\n        ctx.strokeStyle = \"rgba(99, 102, 241, 0.3)\";\r\n        ctx.lineWidth = 2 / this.scale;\r\n        ctx.beginPath();\r\n        ctx.arc(cx, cy, 5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.stroke();\r\n      }\r\n    });\r\n  }\r\n\r\n  _drawEdge(graph, e) {\r\n    const from = graph.nodes.get(e.fromNode);\r\n    const to = graph.nodes.get(e.toNode);\r\n    if (!from || !to) return;\r\n    const iOut = from.outputs.findIndex((p) => p.id === e.fromPort);\r\n    const iIn = to.inputs.findIndex((p) => p.id === e.toPort);\r\n    const pr1 = portRect(from, null, iOut, \"out\");\r\n    const pr2 = portRect(to, null, iIn, \"in\");\r\n    const x1 = pr1.x,\r\n      y1 = pr1.y + 7,\r\n      x2 = pr2.x,\r\n      y2 = pr2.y + 7;\r\n    if (this.edgeStyle === \"line\") {\r\n      this._drawLine(x1, y1, x2, y2);\r\n    } else if (this.edgeStyle === \"orthogonal\") {\r\n      this._drawOrthogonal(x1, y1, x2, y2);\r\n    } else {\r\n      this._drawCurve(x1, y1, x2, y2); // bezier (기존)\r\n    }\r\n  }\r\n\r\n  _drawLine(x1, y1, x2, y2) {\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.stroke();\r\n  }\r\n\r\n  _drawPolyline(points) {\r\n    const { ctx } = this;\r\n    ctx.beginPath();\r\n    ctx.moveTo(points[0].x, points[0].y);\r\n    for (let i = 1; i < points.length; i++)\r\n      ctx.lineTo(points[i].x, points[i].y);\r\n    ctx.stroke();\r\n  }\r\n\r\n  _drawOrthogonal(x1, y1, x2, y2) {\r\n    const dx = Math.abs(x2 - x1);\r\n    const dy = Math.abs(y2 - y1);\r\n    // 중간 축을 결정 (더 짧은 축을 가운데에 두면 보기 좋음)\r\n    const useHVH = true; // 가로-세로-가로(HVH) vs 세로-가로-세로(VHV)\r\n    const midX = (x1 + x2) / 2;\r\n    const midY = (y1 + y2) / 2;\r\n\r\n    let pts;\r\n    if (useHVH) {\r\n      // x1,y1 → midX,y1 → midX,y2 → x2,y2\r\n      pts = [\r\n        { x: x1, y: y1 },\r\n        { x: midX, y: y1 },\r\n        { x: midX, y: y2 },\r\n        { x: x2, y: y2 },\r\n      ];\r\n    }\r\n    // else {\r\n    //   // x1,y1 → x1,midY → x2,midY → x2,y2\r\n    //   pts = [\r\n    //     { x: x1, y: y1 },\r\n    //     { x: x1, y: midY },\r\n    //     { x: x2, y: midY },\r\n    //     { x: x2, y: y2 },\r\n    //   ];\r\n    // }\r\n\r\n    // 라운드 코너\r\n    const { ctx } = this;\r\n    const prevJoin = ctx.lineJoin,\r\n      prevCap = ctx.lineCap;\r\n    ctx.lineJoin = \"round\";\r\n    ctx.lineCap = \"round\";\r\n    this._drawPolyline(pts);\r\n    ctx.lineJoin = prevJoin;\r\n    ctx.lineCap = prevCap;\r\n\r\n    return pts; // 화살표 각도 계산에 사용\r\n  }\r\n  _drawCurve(x1, y1, x2, y2) {\r\n    const { ctx } = this;\r\n    const dx = Math.max(40, Math.abs(x2 - x1) * 0.4);\r\n    ctx.beginPath();\r\n    ctx.moveTo(x1, y1);\r\n    ctx.bezierCurveTo(x1 + dx, y1, x2 - dx, y2, x2, y2);\r\n    ctx.stroke();\r\n  }\r\n}\r\nfunction roundRect(ctx, x, y, w, h, r = 6) {\r\n  if (typeof r === \"number\") r = { tl: r, tr: r, br: r, bl: r };\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r.tl, y);\r\n  ctx.lineTo(x + w - r.tr, y);\r\n  ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\r\n  ctx.lineTo(x + w, y + h - r.br);\r\n  ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\r\n  ctx.lineTo(x + r.bl, y + h);\r\n  ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\r\n  ctx.lineTo(x, y + r.tl);\r\n  ctx.quadraticCurveTo(x, y, x + r.tl, y);\r\n  ctx.closePath();\r\n}\r\n","// Find an edge id by its endpoints (fallback for undo)\r\nfunction findEdgeId(graph, a, b, c, d) {\r\n  for (const [id, e] of graph.edges) {\r\n    if (\r\n      e.fromNode === a &&\r\n      e.fromPort === b &&\r\n      e.toNode === c &&\r\n      e.toPort === d\r\n    )\r\n      return id;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function MoveNodeCmd(node, fromPos, toPos) {\r\n  return {\r\n    do() {\r\n      node.pos = { ...toPos };\r\n    },\r\n    undo() {\r\n      node.pos = { ...fromPos };\r\n    },\r\n  };\r\n}\r\n\r\nexport function AddEdgeCmd(graph, fromNode, fromPort, toNode, toPort) {\r\n  let addedId = null;\r\n  return {\r\n    do() {\r\n      graph.addEdge(fromNode, fromPort, toNode, toPort);\r\n      addedId = findEdgeId(graph, fromNode, fromPort, toNode, toPort);\r\n    },\r\n    undo() {\r\n      const id =\r\n        addedId ?? findEdgeId(graph, fromNode, fromPort, toNode, toPort);\r\n      if (id != null) graph.edges.delete(id);\r\n    },\r\n  };\r\n}\r\n\r\nexport function RemoveEdgeCmd(graph, edgeId) {\r\n  const e = graph.edges.get(edgeId);\r\n  if (!e) return null;\r\n  // capture for undo\r\n  const { fromNode, fromPort, toNode, toPort } = e;\r\n  return {\r\n    do() {\r\n      graph.edges.delete(edgeId);\r\n    },\r\n    undo() {\r\n      graph.addEdge(fromNode, fromPort, toNode, toPort);\r\n    },\r\n  };\r\n}\r\n\r\n// Optional: group multiple commands as one (used for \"rewire\")\r\nexport function CompoundCmd(cmds) {\r\n  return {\r\n    do() {\r\n      cmds.forEach((c) => c?.do());\r\n    },\r\n    undo() {\r\n      [...cmds].reverse().forEach((c) => c?.undo());\r\n    },\r\n  };\r\n}\r\n\r\nexport function RemoveNodeCmd(graph, node) {\r\n  let removedNode = null;\r\n  let removedEdges = [];\r\n\r\n  return {\r\n    do() {\r\n      // Store the node and its connected edges for undo\r\n      removedNode = node;\r\n      removedEdges = graph.edges\r\n        ? [...graph.edges.values()].filter((e) => {\r\n          return e.fromNode === node.id || e.toNode === node.id;\r\n        })\r\n        : [];\r\n\r\n      // Remove edges first\r\n      for (const edge of removedEdges) {\r\n        graph.edges.delete(edge.id);\r\n      }\r\n      // Remove the node\r\n      graph.nodes.delete(node.id);\r\n    },\r\n\r\n    undo() {\r\n      // Restore node\r\n      if (removedNode) {\r\n        graph.nodes.set(removedNode.id, removedNode);\r\n      }\r\n      // Restore edges\r\n      for (const edge of removedEdges) {\r\n        graph.edges.set(edge.id, edge);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport function ResizeNodeCmd(node, fromSize, toSize) {\r\n  return {\r\n    do() {\r\n      node.size.width = toSize.w;\r\n      node.size.height = toSize.h;\r\n    },\r\n    undo() {\r\n      node.size.width = fromSize.w;\r\n      node.size.height = fromSize.h;\r\n    },\r\n  };\r\n}\r\n\r\nexport function ChangeGroupColorCmd(node, fromColor, toColor) {\r\n  return {\r\n    do() {\r\n      node.state.color = toColor;\r\n    },\r\n    undo() {\r\n      node.state.color = fromColor;\r\n    },\r\n  };\r\n}\r\n","// src/core/CommandStack.js\r\nexport class CommandStack {\r\n  constructor() {\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n  }\r\n  exec(cmd) {\r\n    cmd.do();\r\n    this.undoStack.push(cmd);\r\n    this.redoStack.length = 0;\r\n  }\r\n  undo() {\r\n    const c = this.undoStack.pop();\r\n    if (c) {\r\n      c.undo();\r\n      this.redoStack.push(c);\r\n    }\r\n  }\r\n  redo() {\r\n    const c = this.redoStack.pop();\r\n    if (c) {\r\n      c.do();\r\n      this.undoStack.push(c);\r\n    }\r\n  }\r\n}\r\n","import { hitTestNode, portRect } from \"../render/hitTest.js\";\r\nimport {\r\n  MoveNodeCmd,\r\n  AddEdgeCmd,\r\n  RemoveEdgeCmd,\r\n  CompoundCmd,\r\n  RemoveNodeCmd,\r\n  ResizeNodeCmd,\r\n} from \"../core/commands.js\";\r\nimport { CommandStack } from \"../core/CommandStack.js\";\r\n\r\nexport class Controller {\r\n\r\n  static MIN_NODE_WIDTH = 80;\r\n  static MIN_NODE_HEIGHT = 60;\r\n\r\n  constructor({ graph, renderer, hooks, htmlOverlay, contextMenu, portRenderer }) {\r\n    this.graph = graph;\r\n    this.renderer = renderer;\r\n    this.hooks = hooks;\r\n    this.htmlOverlay = htmlOverlay;\r\n    this.contextMenu = contextMenu;\r\n    this.portRenderer = portRenderer; // Separate renderer for ports above HTML\r\n\r\n    this.stack = new CommandStack();\r\n    this.selection = new Set();\r\n    this.dragging = null; // { nodeId, dx, dy }\r\n    this.connecting = null; // { fromNode, fromPort, x(screen), y(screen) }\r\n    this.panning = null; // { x(screen), y(screen) }\r\n    this.resizing = null;\r\n    this.gDragging = null;\r\n    this.gResizing = null;\r\n    this.boxSelecting = null; // { startX, startY, currentX, currentY } - world coords\r\n\r\n    // Feature flags\r\n    this.snapToGrid = true; // Snap nodes to grid (toggle with G key)\r\n    this.gridSize = 20; // Grid size for snapping\r\n\r\n    this._cursor = \"default\";\r\n\r\n    this._onKeyPressEvt = this._onKeyPress.bind(this);\r\n    this._onDownEvt = this._onDown.bind(this);\r\n    this._onWheelEvt = this._onWheel.bind(this);\r\n    this._onMoveEvt = this._onMove.bind(this);\r\n    this._onUpEvt = this._onUp.bind(this);\r\n    this._onContextMenuEvt = this._onContextMenu.bind(this);\r\n    this._onDblClickEvt = this._onDblClick.bind(this);\r\n\r\n    this._bindEvents();\r\n  }\r\n\r\n  destroy() {\r\n    const c = this.renderer.canvas;\r\n    c.removeEventListener(\"mousedown\", this._onDownEvt);\r\n    c.removeEventListener(\"dblclick\", this._onDblClickEvt);\r\n    c.removeEventListener(\"wheel\", this._onWheelEvt, { passive: false });\r\n    c.removeEventListener(\"contextmenu\", this._onContextMenuEvt);\r\n    window.removeEventListener(\"mousemove\", this._onMoveEvt);\r\n    window.removeEventListener(\"mouseup\", this._onUpEvt);\r\n    window.removeEventListener(\"keydown\", this._onKeyPressEvt);\r\n  }\r\n\r\n  _bindEvents() {\r\n    const c = this.renderer.canvas;\r\n    c.addEventListener(\"mousedown\", this._onDownEvt);\r\n    c.addEventListener(\"dblclick\", this._onDblClickEvt);\r\n    c.addEventListener(\"wheel\", this._onWheelEvt, { passive: false });\r\n    c.addEventListener(\"contextmenu\", this._onContextMenuEvt);\r\n    window.addEventListener(\"mousemove\", this._onMoveEvt);\r\n    window.addEventListener(\"mouseup\", this._onUpEvt);\r\n    window.addEventListener(\"keydown\", this._onKeyPressEvt);\r\n  }\r\n\r\n  _onKeyPress(e) {\r\n    this.isAlt = e.altKey;\r\n    this.isShift = e.shiftKey;\r\n    this.isCtrl = e.ctrlKey;\r\n\r\n    // Toggle snap-to-grid with G key\r\n    if (e.key.toLowerCase() === \"g\" && !e.ctrlKey && !e.metaKey) {\r\n      this.snapToGrid = !this.snapToGrid;\r\n      this.render(); // Update UI\r\n      return;\r\n    }\r\n\r\n    // Group selected nodes: Ctrl/Cmd + G\r\n    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"g\") {\r\n      e.preventDefault();\r\n      this._createGroupFromSelection();\r\n      return;\r\n    }\r\n\r\n    // Undo: Ctrl/Cmd + Z  (Shift+Z → Redo)\r\n    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"z\") {\r\n      e.preventDefault();\r\n      if (e.shiftKey) this.stack.redo();\r\n      else this.stack.undo();\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // Redo: Ctrl/Cmd + Y\r\n    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"y\") {\r\n      e.preventDefault();\r\n      this.stack.redo();\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // Align nodes: A (horizontal), Shift+A (vertical)\r\n    if (e.key.toLowerCase() === \"a\" && this.selection.size > 1) {\r\n      e.preventDefault();\r\n      if (e.shiftKey) {\r\n        this._alignNodesVertical();\r\n      } else {\r\n        this._alignNodesHorizontal();\r\n      }\r\n      return;\r\n    }\r\n\r\n    // remove the selected nodes\r\n    if (e.key === \"Delete\") {\r\n      [...this.selection].forEach((node) => {\r\n        const nodeObj = this.graph.getNodeById(node);\r\n        this.stack.exec(RemoveNodeCmd(this.graph, nodeObj));\r\n        this.graph.removeNode(node);\r\n      });\r\n\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  _setCursor(c) {\r\n    if (this._cursor !== c) {\r\n      this._cursor = c;\r\n      this.renderer.canvas.style.cursor = c;\r\n    }\r\n  }\r\n\r\n  _posScreen(e) {\r\n    const r = this.renderer.canvas.getBoundingClientRect();\r\n    return { x: e.clientX - r.left, y: e.clientY - r.top };\r\n  }\r\n\r\n  _posWorld(e) {\r\n    const s = this._posScreen(e);\r\n    return this.renderer.screenToWorld(s.x, s.y);\r\n  }\r\n\r\n  _findNodeAtWorld(x, y) {\r\n    // Reverse order (top to bottom)\r\n    const list = [...this.graph.nodes.values()].reverse();\r\n\r\n    for (const n of list) {\r\n      // Use computed world transform for hit testing\r\n      const { x: nx, y: ny, w, h } = n.computed;\r\n      if (x >= nx && x <= nx + w && y >= ny && y <= ny + h) {\r\n        // If this is a group, check if any of its children are under the cursor\r\n        if (n.type === \"core/Group\") {\r\n          // Check all children of this group (recursively)\r\n          const child = this._findChildNodeAtWorld(n, x, y);\r\n          if (child) {\r\n            return child; // Return the child instead of the group\r\n          }\r\n        }\r\n        return n;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Find child node at world coordinates (recursive helper for _findNodeAtWorld)\r\n   * @param {Node} parentNode - Parent node (group)\r\n   * @param {number} x - World x coordinate\r\n   * @param {number} y - World y coordinate\r\n   * @returns {Node|null} - Child node at position, or null\r\n   */\r\n  _findChildNodeAtWorld(parentNode, x, y) {\r\n    // Get all children of this parent\r\n    const children = [];\r\n    for (const node of this.graph.nodes.values()) {\r\n      if (node.parent === parentNode) {\r\n        children.push(node);\r\n      }\r\n    }\r\n\r\n    // Check children in reverse order (top to bottom)\r\n    for (let i = children.length - 1; i >= 0; i--) {\r\n      const child = children[i];\r\n      const { x: nx, y: ny, w, h } = child.computed;\r\n\r\n      if (x >= nx && x <= nx + w && y >= ny && y <= ny + h) {\r\n        // If this child is also a group, recursively check its children\r\n        if (child.type === \"core/Group\") {\r\n          const grandchild = this._findChildNodeAtWorld(child, x, y);\r\n          if (grandchild) {\r\n            return grandchild;\r\n          }\r\n        }\r\n        return child;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _findPortAtWorld(x, y) {\r\n    for (const n of this.graph.nodes.values()) {\r\n      for (let i = 0; i < n.inputs.length; i++) {\r\n        const r = portRect(n, n.inputs[i], i, \"in\");\r\n        if (rectHas(r, x, y))\r\n          return { node: n, port: n.inputs[i], dir: \"in\", idx: i };\r\n      }\r\n      for (let i = 0; i < n.outputs.length; i++) {\r\n        const r = portRect(n, n.outputs[i], i, \"out\");\r\n        if (rectHas(r, x, y))\r\n          return { node: n, port: n.outputs[i], dir: \"out\", idx: i };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _findIncomingEdge(nodeId, portId) {\r\n    for (const [eid, e] of this.graph.edges) {\r\n      if (e.toNode === nodeId && e.toPort === portId) {\r\n        return { id: eid, edge: e };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _onWheel(e) {\r\n    e.preventDefault();\r\n    const { x, y } = this._posScreen(e);\r\n    const factor = Math.pow(1.0015, -e.deltaY); // smooth zoom\r\n    this.renderer.zoomAt(factor, x, y);\r\n    this.render();\r\n  }\r\n\r\n  _onContextMenu(e) {\r\n    e.preventDefault();\r\n\r\n    // Only show context menu if we have a contextMenu instance\r\n    if (!this.contextMenu) return;\r\n\r\n    const w = this._posWorld(e);\r\n    const node = this._findNodeAtWorld(w.x, w.y);\r\n\r\n    // Show menu with node or null (for canvas background) and world position\r\n    this.contextMenu.show(node, e.clientX, e.clientY, w);\r\n  }\r\n\r\n  _onDblClick(e) {\r\n    const w = this._posWorld(e);\r\n    const node = this._findNodeAtWorld(w.x, w.y);\r\n\r\n    if (node) {\r\n      this.hooks?.emit(\"node:dblclick\", node);\r\n    }\r\n  }\r\n\r\n  _resizeHandleRect(node) {\r\n    const s = 10;\r\n    const { x, y, w, h } = node.computed;\r\n    return {\r\n      x: x + w - s,\r\n      y: y + h - s,\r\n      w: s,\r\n      h: s,\r\n    };\r\n  }\r\n\r\n  _hitResizeHandle(node, wx, wy) {\r\n    const r = this._resizeHandleRect(node);\r\n    return wx >= r.x && wx <= r.x + r.w && wy >= r.y && wy <= r.y + r.h;\r\n  }\r\n\r\n  _onDown(e) {\r\n    const s = this._posScreen(e);\r\n    const w = this._posWorld(e);\r\n\r\n    if (e.button === 1) {\r\n      this.panning = { x: s.x, y: s.y };\r\n      return;\r\n    }\r\n\r\n    // 1. Resize Handle Hit Test (for all nodes including groups)\r\n    const node = this._findNodeAtWorld(w.x, w.y);\r\n    if (e.button === 0 && node && this._hitResizeHandle(node, w.x, w.y)) {\r\n      this.resizing = {\r\n        nodeId: node.id,\r\n        startW: node.size.width,\r\n        startH: node.size.height,\r\n        startX: w.x,\r\n        startY: w.y,\r\n      };\r\n      if (!e.shiftKey) this.selection.clear();\r\n      this.selection.add(node.id);\r\n      this._setCursor(\"se-resize\");\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 2. Port Hit Test\r\n    const port = this._findPortAtWorld(w.x, w.y);\r\n\r\n    // Handle input port click - disconnect existing connection\r\n    if (e.button === 0 && port && port.dir === \"in\") {\r\n      const incoming = this._findIncomingEdge(port.node.id, port.port.id);\r\n      if (incoming) {\r\n        // Disconnect the existing edge\r\n        this.stack.exec(RemoveEdgeCmd(this.graph, incoming.id));\r\n        this.render();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Handle output port click - start new connection\r\n    if (e.button === 0 && port && port.dir === \"out\") {\r\n      const outR = portRect(port.node, port.port, port.idx, \"out\");\r\n      const screenFrom = this.renderer.worldToScreen(outR.x, outR.y + 7);\r\n      this.connecting = {\r\n        fromNode: port.node.id,\r\n        fromPort: port.port.id,\r\n        x: screenFrom.x,\r\n        y: screenFrom.y,\r\n      };\r\n      return;\r\n    }\r\n\r\n    // 3. Node Hit Test (Selection & Drag)\r\n    if (e.button === 0 && node) {\r\n      if (!e.shiftKey) this.selection.clear();\r\n      this.selection.add(node.id);\r\n\r\n      // Dragging: store initial world pos difference for all selected nodes\r\n      this.dragging = {\r\n        nodeId: node.id,\r\n        offsetX: w.x - node.computed.x,\r\n        offsetY: w.y - node.computed.y,\r\n        startPos: { ...node.pos }, // for undo\r\n        selectedNodes: [], // Store all selected nodes and their initial positions\r\n      };\r\n\r\n      // Store positions of all selected nodes\r\n      for (const selectedId of this.selection) {\r\n        const selectedNode = this.graph.nodes.get(selectedId);\r\n        if (selectedNode) {\r\n          this.dragging.selectedNodes.push({\r\n            node: selectedNode,\r\n            startWorldX: selectedNode.computed.x,\r\n            startWorldY: selectedNode.computed.y,\r\n            startLocalX: selectedNode.pos.x,\r\n            startLocalY: selectedNode.pos.y,\r\n          });\r\n        }\r\n      }\r\n\r\n      // If dragging a group, store children's world positions\r\n      if (node.type === \"core/Group\") {\r\n        this.dragging.childrenWorldPos = [];\r\n        for (const child of this.graph.nodes.values()) {\r\n          if (child.parent === node) {\r\n            this.dragging.childrenWorldPos.push({\r\n              node: child,\r\n              worldX: child.computed.x,\r\n              worldY: child.computed.y,\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    // 4. Background Click (Pan or Box Selection)\r\n    if (e.button === 0) {\r\n      if (this.selection.size) this.selection.clear();\r\n\r\n      // Start box selection if Ctrl is held\r\n      if (e.ctrlKey || e.metaKey) {\r\n        this.boxSelecting = {\r\n          startX: w.x,\r\n          startY: w.y,\r\n          currentX: w.x,\r\n          currentY: w.y,\r\n        };\r\n      } else {\r\n        this.panning = { x: s.x, y: s.y };\r\n      }\r\n      this.render();\r\n      return;\r\n    }\r\n  }\r\n\r\n  _onMove(e) {\r\n    // Track key states\r\n    this.isAlt = e.altKey;\r\n    this.isShift = e.shiftKey;\r\n    this.isCtrl = e.ctrlKey;\r\n\r\n    const s = this._posScreen(e);\r\n    const w = this.renderer.screenToWorld(s.x, s.y);\r\n\r\n    if (this.resizing) {\r\n      const n = this.graph.nodes.get(this.resizing.nodeId);\r\n      const dx = w.x - this.resizing.startX;\r\n      const dy = w.y - this.resizing.startY;\r\n\r\n      const minW = Controller.MIN_NODE_WIDTH;\r\n      const minH = Controller.MIN_NODE_HEIGHT;\r\n      n.size.width = Math.max(minW, this.resizing.startW + dx);\r\n      n.size.height = Math.max(minH, this.resizing.startH + dy);\r\n\r\n      this.hooks?.emit(\"node:resize\", n);\r\n      this._setCursor(\"se-resize\");\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.panning) {\r\n      const dx = s.x - this.panning.x;\r\n      const dy = s.y - this.panning.y;\r\n      this.panning = { x: s.x, y: s.y };\r\n      this.renderer.panBy(dx, dy);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.dragging) {\r\n      const n = this.graph.nodes.get(this.dragging.nodeId);\r\n\r\n      // Calculate delta for main node\r\n      let targetWx = w.x - this.dragging.offsetX;\r\n      let targetWy = this.isShift ? w.y - 0 : w.y - this.dragging.offsetY;\r\n\r\n      // Apply snap-to-grid if enabled\r\n      if (this.snapToGrid) {\r\n        targetWx = this._snapToGrid(targetWx);\r\n        targetWy = this._snapToGrid(targetWy);\r\n      }\r\n\r\n      // Calculate delta from original position\r\n      const deltaX = targetWx - this.dragging.selectedNodes.find(sn => sn.node.id === n.id).startWorldX;\r\n      const deltaY = targetWy - this.dragging.selectedNodes.find(sn => sn.node.id === n.id).startWorldY;\r\n\r\n      // Update world transforms\r\n      this.graph.updateWorldTransforms();\r\n\r\n      // Move all selected nodes by the same delta\r\n      for (const { node: selectedNode, startWorldX, startWorldY } of this.dragging.selectedNodes) {\r\n        // Skip group nodes when shift-dragging (vertical only)\r\n        if (this.isShift && selectedNode.type === \"core/Group\") {\r\n          continue;\r\n        }\r\n\r\n        let newWorldX = startWorldX + deltaX;\r\n        let newWorldY = startWorldY + deltaY;\r\n\r\n        // Convert to local position\r\n        let parentWx = 0;\r\n        let parentWy = 0;\r\n        if (selectedNode.parent) {\r\n          parentWx = selectedNode.parent.computed.x;\r\n          parentWy = selectedNode.parent.computed.y;\r\n        }\r\n\r\n        selectedNode.pos.x = newWorldX - parentWx;\r\n        selectedNode.pos.y = newWorldY - parentWy;\r\n      }\r\n\r\n      // If Alt is held and dragging a group, restore children to original world positions\r\n      if (this.isAlt && n.type === \"core/Group\" && this.dragging.childrenWorldPos) {\r\n        this.graph.updateWorldTransforms();\r\n        for (const childInfo of this.dragging.childrenWorldPos) {\r\n          const child = childInfo.node;\r\n          const newGroupX = n.computed.x;\r\n          const newGroupY = n.computed.y;\r\n\r\n          child.pos.x = childInfo.worldX - newGroupX;\r\n          child.pos.y = childInfo.worldY - newGroupY;\r\n        }\r\n      }\r\n\r\n      this.hooks?.emit(\"node:move\", n);\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.boxSelecting) {\r\n      this.boxSelecting.currentX = w.x;\r\n      this.boxSelecting.currentY = w.y;\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    if (this.connecting) {\r\n      this.connecting.x = s.x;\r\n      this.connecting.y = s.y;\r\n      this.render();\r\n    }\r\n\r\n    // Cursor update\r\n    const port = this._findPortAtWorld(w.x, w.y);\r\n    const node = this._findNodeAtWorld(w.x, w.y);\r\n\r\n    if (node && this._hitResizeHandle(node, w.x, w.y)) {\r\n      this._setCursor(\"se-resize\");\r\n    } else if (port) {\r\n      // Show pointer cursor over ports (for connecting/disconnecting)\r\n      this._setCursor(\"pointer\");\r\n    } else {\r\n      this._setCursor(\"default\");\r\n    }\r\n  }\r\n\r\n  _onUp(e) {\r\n    this.isAlt = e.altKey;\r\n    this.isShift = e.shiftKey;\r\n    this.isCtrl = e.ctrlKey;\r\n\r\n    const w = this._posWorld(e);\r\n\r\n    if (this.panning) {\r\n      this.panning = null;\r\n      return;\r\n    }\r\n\r\n    if (this.connecting) {\r\n      // ... (existing connection logic)\r\n      const from = this.connecting;\r\n      const portIn = this._findPortAtWorld(w.x, w.y);\r\n      if (portIn && portIn.dir === \"in\") {\r\n        this.stack.exec(\r\n          AddEdgeCmd(\r\n            this.graph,\r\n            from.fromNode,\r\n            from.fromPort,\r\n            portIn.node.id,\r\n            portIn.port.id\r\n          )\r\n        );\r\n      }\r\n      this.connecting = null;\r\n      this.render();\r\n    }\r\n\r\n    if (this.resizing) {\r\n      const n = this.graph.nodes.get(this.resizing.nodeId);\r\n      const from = { w: this.resizing.startW, h: this.resizing.startH };\r\n      const to = { w: n.size.width, h: n.size.height };\r\n      if (from.w !== to.w || from.h !== to.h) {\r\n        this.stack.exec(ResizeNodeCmd(n, from, to));\r\n      }\r\n      this.resizing = null;\r\n      this._setCursor(\"default\");\r\n    }\r\n\r\n    if (this.dragging) {\r\n      const n = this.graph.nodes.get(this.dragging.nodeId);\r\n\r\n      // If we're dragging a GROUP with Alt, only move the group (keep children in place)\r\n      if (n.type === \"core/Group\" && this.isAlt && this.dragging.childrenWorldPos) {\r\n        // Restore children to their original world positions\r\n        for (const childInfo of this.dragging.childrenWorldPos) {\r\n          const child = childInfo.node;\r\n          // Convert world position back to local position relative to new group position\r\n          this.graph.updateWorldTransforms();\r\n          const newGroupX = n.computed.x;\r\n          const newGroupY = n.computed.y;\r\n\r\n          child.pos.x = childInfo.worldX - newGroupX;\r\n          child.pos.y = childInfo.worldY - newGroupY;\r\n        }\r\n      } else if (n.type === \"core/Group\" && !this.isAlt) {\r\n        // Normal group drag - auto-parent nodes\r\n        this._autoParentNodesInGroup(n);\r\n      } else if (n.type !== \"core/Group\") {\r\n        // Normal node: Reparenting Logic\r\n        // Check if dropped onto a group\r\n        const potentialParent = this._findPotentialParent(w.x, w.y, n);\r\n\r\n        if (potentialParent && potentialParent !== n.parent) {\r\n          this.graph.reparent(n, potentialParent);\r\n        } else if (!potentialParent && n.parent) {\r\n          // Dropped on empty space -> move to root\r\n          this.graph.reparent(n, null);\r\n        }\r\n      }\r\n\r\n      this.dragging = null;\r\n      this.render();\r\n    }\r\n\r\n    if (this.boxSelecting) {\r\n      // Select all nodes within the box\r\n      const { startX, startY, currentX, currentY } = this.boxSelecting;\r\n      const minX = Math.min(startX, currentX);\r\n      const maxX = Math.max(startX, currentX);\r\n      const minY = Math.min(startY, currentY);\r\n      const maxY = Math.max(startY, currentY);\r\n\r\n      for (const node of this.graph.nodes.values()) {\r\n        const { x, y, w, h } = node.computed;\r\n        // Check if node intersects with selection box\r\n        if (x + w >= minX && x <= maxX && y + h >= minY && y <= maxY) {\r\n          this.selection.add(node.id);\r\n        }\r\n      }\r\n\r\n      this.boxSelecting = null;\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Automatically parent nodes that are within the group's bounds\r\n   * @param {Node} groupNode - The group node\r\n   */\r\n  _autoParentNodesInGroup(groupNode) {\r\n    const { x: gx, y: gy, w: gw, h: gh } = groupNode.computed;\r\n\r\n    // Find all nodes that are within the group bounds\r\n    for (const node of this.graph.nodes.values()) {\r\n      // Skip the group itself\r\n      if (node === groupNode) continue;\r\n\r\n      // Skip if it's already a child of this group\r\n      if (node.parent === groupNode) continue;\r\n\r\n      // Skip if it's another group (prevent nested groups for now)\r\n      if (node.type === \"core/Group\") continue;\r\n\r\n      // Check if node is within group bounds\r\n      const { x: nx, y: ny, w: nw, h: nh } = node.computed;\r\n      const nodeCenterX = nx + nw / 2;\r\n      const nodeCenterY = ny + nh / 2;\r\n\r\n      // Use center point to determine if node is inside group\r\n      if (\r\n        nodeCenterX >= gx &&\r\n        nodeCenterX <= gx + gw &&\r\n        nodeCenterY >= gy &&\r\n        nodeCenterY <= gy + gh\r\n      ) {\r\n        // Parent this node to the group\r\n        this.graph.reparent(node, groupNode);\r\n      }\r\n    }\r\n  }\r\n\r\n  _findPotentialParent(x, y, excludeNode) {\r\n    // Find top-most group under x,y that is not excludeNode or its descendants\r\n    const list = [...this.graph.nodes.values()].reverse();\r\n    for (const n of list) {\r\n      if (n.type !== \"core/Group\") continue;\r\n      if (n === excludeNode) continue;\r\n      // Check if n is descendant of excludeNode\r\n      let p = n.parent;\r\n      let isDescendant = false;\r\n      while (p) {\r\n        if (p === excludeNode) {\r\n          isDescendant = true;\r\n          break;\r\n        }\r\n        p = p.parent;\r\n      }\r\n      if (isDescendant) continue;\r\n\r\n      const { x: nx, y: ny, w, h } = n.computed;\r\n      if (x >= nx && x <= nx + w && y >= ny && y <= ny + h) {\r\n        return n;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Snap a coordinate to the grid\r\n   * @param {number} value - The value to snap\r\n   * @returns {number} - Snapped value\r\n   */\r\n  _snapToGrid(value) {\r\n    return Math.round(value / this.gridSize) * this.gridSize;\r\n  }\r\n\r\n  /**\r\n   * Create a group from currently selected nodes\r\n   */\r\n  _createGroupFromSelection() {\r\n    if (this.selection.size === 0) {\r\n      console.warn(\"No nodes selected to group\");\r\n      return;\r\n    }\r\n\r\n    // Get selected nodes\r\n    const selectedNodes = Array.from(this.selection).map(id => this.graph.getNodeById(id));\r\n\r\n    // Calculate bounding box\r\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n    for (const node of selectedNodes) {\r\n      const { x, y, w, h } = node.computed;\r\n      minX = Math.min(minX, x);\r\n      minY = Math.min(minY, y);\r\n      maxX = Math.max(maxX, x + w);\r\n      maxY = Math.max(maxY, y + h);\r\n    }\r\n\r\n    const margin = 20;\r\n    const groupX = minX - margin;\r\n    const groupY = minY - margin;\r\n    const groupWidth = maxX - minX + margin * 2;\r\n    const groupHeight = maxY - minY + margin * 2;\r\n\r\n    // Create group via GroupManager\r\n    if (this.graph.groupManager) {\r\n      this.graph.groupManager.addGroup({\r\n        title: \"Group\",\r\n        x: groupX,\r\n        y: groupY,\r\n        width: groupWidth,\r\n        height: groupHeight,\r\n        members: Array.from(this.selection),\r\n      });\r\n      this.selection.clear();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Align selected nodes horizontally (same Y position)\r\n   */\r\n  _alignNodesHorizontal() {\r\n    if (this.selection.size < 2) return;\r\n\r\n    const nodes = Array.from(this.selection).map(id => this.graph.getNodeById(id));\r\n    const avgY = nodes.reduce((sum, n) => sum + n.computed.y, 0) / nodes.length;\r\n\r\n    for (const node of nodes) {\r\n      const parentY = node.parent ? node.parent.computed.y : 0;\r\n      node.pos.y = avgY - parentY;\r\n    }\r\n\r\n    this.graph.updateWorldTransforms();\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Align selected nodes vertically (same X position)\r\n   */\r\n  _alignNodesVertical() {\r\n    if (this.selection.size < 2) return;\r\n\r\n    const nodes = Array.from(this.selection).map(id => this.graph.getNodeById(id));\r\n    const avgX = nodes.reduce((sum, n) => sum + n.computed.x, 0) / nodes.length;\r\n\r\n    for (const node of nodes) {\r\n      const parentX = node.parent ? node.parent.computed.x : 0;\r\n      node.pos.x = avgX - parentX;\r\n    }\r\n\r\n    this.graph.updateWorldTransforms();\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    const tEdge = this.renderTempEdge();\r\n\r\n    this.renderer.draw(this.graph, {\r\n      selection: this.selection,\r\n      tempEdge: tEdge,\r\n      boxSelecting: this.boxSelecting,\r\n      activeEdges: this.activeEdges || new Set(), // For animation\r\n    });\r\n\r\n    this.htmlOverlay?.draw(this.graph, this.selection);\r\n\r\n    // Draw box selection rectangle on top of everything\r\n    if (this.boxSelecting) {\r\n      const { startX, startY, currentX, currentY } = this.boxSelecting;\r\n      const minX = Math.min(startX, currentX);\r\n      const minY = Math.min(startY, currentY);\r\n      const width = Math.abs(currentX - startX);\r\n      const height = Math.abs(currentY - startY);\r\n\r\n      const screenStart = this.renderer.worldToScreen(minX, minY);\r\n      const screenEnd = this.renderer.worldToScreen(minX + width, minY + height);\r\n\r\n      const ctx = this.renderer.ctx;\r\n      ctx.save();\r\n      this.renderer._resetTransform();\r\n\r\n      // Draw selection box\r\n      ctx.strokeStyle = \"#6cf\";\r\n      ctx.fillStyle = \"rgba(102, 204, 255, 0.1)\";\r\n      ctx.lineWidth = 2;\r\n      ctx.strokeRect(screenStart.x, screenStart.y, screenEnd.x - screenStart.x, screenEnd.y - screenStart.y);\r\n      ctx.fillRect(screenStart.x, screenStart.y, screenEnd.x - screenStart.x, screenEnd.y - screenStart.y);\r\n\r\n      ctx.restore();\r\n    }\r\n\r\n    // Draw ports for HTML overlay nodes on separate canvas (above HTML)\r\n    if (this.portRenderer) {\r\n      // Clear port canvas\r\n      const portCtx = this.portRenderer.ctx;\r\n      portCtx.clearRect(0, 0, this.portRenderer.canvas.width, this.portRenderer.canvas.height);\r\n\r\n      // Sync transform\r\n      this.portRenderer.scale = this.renderer.scale;\r\n      this.portRenderer.offsetX = this.renderer.offsetX;\r\n      this.portRenderer.offsetY = this.renderer.offsetY;\r\n\r\n      // Draw ports for HTML overlay nodes\r\n      this.portRenderer._applyTransform();\r\n      for (const n of this.graph.nodes.values()) {\r\n        if (n.type !== \"core/Group\") {\r\n          const def = this.portRenderer.registry?.types?.get(n.type);\r\n          const hasHtmlOverlay = !!(def?.html);\r\n\r\n          if (hasHtmlOverlay) {\r\n            this.portRenderer._drawPorts(n);\r\n          }\r\n        }\r\n      }\r\n      this.portRenderer._resetTransform();\r\n    }\r\n  }\r\n\r\n  renderTempEdge() {\r\n    if (!this.connecting) return null;\r\n    const a = this._portAnchorScreen(\r\n      this.connecting.fromNode,\r\n      this.connecting.fromPort\r\n    ); // {x,y}\r\n    return {\r\n      x1: a.x,\r\n      y1: a.y,\r\n      x2: this.connecting.x,\r\n      y2: this.connecting.y,\r\n    };\r\n  }\r\n\r\n  _portAnchorScreen(nodeId, portId) {\r\n    const n = this.graph.nodes.get(nodeId);\r\n    const iOut = n.outputs.findIndex((p) => p.id === portId);\r\n    const r = portRect(n, null, iOut, \"out\"); // world rect\r\n    return this.renderer.worldToScreen(r.x, r.y + 7); // -> screen point\r\n  }\r\n}\r\n\r\nfunction rectHas(r, x, y) {\r\n  return x >= r.x && x <= r.x + r.w && y >= r.y && y <= r.y + r.h;\r\n}\r\n","/**\r\n * ContextMenu - Extensible context menu for nodes and groups\r\n * Provides right-click functionality with customizable menu items\r\n */\r\nexport class ContextMenu {\r\n  constructor({ graph, hooks, renderer, commandStack }) {\r\n    this.graph = graph;\r\n    this.hooks = hooks;\r\n    this.renderer = renderer;\r\n    this.commandStack = commandStack;\r\n\r\n    this.items = [];\r\n    this.visible = false;\r\n    this.target = null;\r\n    this.position = { x: 0, y: 0 };\r\n\r\n    this.menuElement = this._createMenuElement();\r\n\r\n    // Close menu on any click outside\r\n    this._onDocumentClick = (e) => {\r\n      if (!this.menuElement.contains(e.target)) {\r\n        this.hide();\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a menu item\r\n   * @param {string} id - Unique identifier for the menu item\r\n   * @param {string} label - Display label\r\n   * @param {Object} options - Options\r\n   * @param {Function} options.action - Action to execute (receives target)\r\n   * @param {Array} options.submenu - Submenu items\r\n   * @param {Function} options.condition - Optional condition to show item (receives target)\r\n   * @param {number} options.order - Optional sort order (default: 100)\r\n   */\r\n  addItem(id, label, options = {}) {\r\n    const { action, submenu, condition, order = 100 } = options;\r\n\r\n    // Either action or submenu must be provided\r\n    if (!action && !submenu) {\r\n      console.error(\"ContextMenu.addItem: either action or submenu is required\");\r\n      return;\r\n    }\r\n\r\n    // Remove existing item with same id\r\n    this.removeItem(id);\r\n\r\n    this.items.push({\r\n      id,\r\n      label,\r\n      action,\r\n      submenu,\r\n      condition,\r\n      order,\r\n    });\r\n\r\n    // Sort by order\r\n    this.items.sort((a, b) => a.order - b.order);\r\n  }\r\n\r\n  /**\r\n   * Remove a menu item by id\r\n   * @param {string} id - Item id to remove\r\n   */\r\n  removeItem(id) {\r\n    this.items = this.items.filter((item) => item.id !== id);\r\n  }\r\n\r\n  /**\r\n   * Show the context menu\r\n   * @param {Object} target - Target node/group\r\n   * @param {number} x - Screen x position\r\n   * @param {number} y - Screen y position\r\n   * @param {Object} worldPos - Optional world position {x, y}\r\n   */\r\n  show(target, x, y, worldPos = null) {\r\n    this.target = target;\r\n    this.position = { x, y };\r\n    this.worldPosition = worldPos; // Store world position for node creation\r\n    this.visible = true;\r\n\r\n    this._renderItems();\r\n\r\n    // Position menu\r\n    this.menuElement.style.left = `${x}px`;\r\n    this.menuElement.style.top = `${y}px`;\r\n    this.menuElement.style.display = \"block\";\r\n\r\n    // Adjust position if menu goes off-screen\r\n    requestAnimationFrame(() => {\r\n      const rect = this.menuElement.getBoundingClientRect();\r\n      const vw = window.innerWidth;\r\n      const vh = window.innerHeight;\r\n\r\n      let adjustedX = x;\r\n      let adjustedY = y;\r\n\r\n      if (rect.right > vw) {\r\n        adjustedX = vw - rect.width - 5;\r\n      }\r\n      if (rect.bottom > vh) {\r\n        adjustedY = vh - rect.height - 5;\r\n      }\r\n\r\n      this.menuElement.style.left = `${adjustedX}px`;\r\n      this.menuElement.style.top = `${adjustedY}px`;\r\n    });\r\n\r\n    // Listen for clicks to close menu\r\n    document.addEventListener(\"click\", this._onDocumentClick);\r\n  }\r\n\r\n  /**\r\n   * Hide the context menu\r\n   */\r\n  hide() {\r\n    this.visible = false;\r\n    this.target = null;\r\n\r\n    // Clean up any open submenus\r\n    const allSubmenus = document.querySelectorAll(\".context-submenu\");\r\n    allSubmenus.forEach(submenu => submenu.remove());\r\n\r\n    this.menuElement.style.display = \"none\";\r\n    document.removeEventListener(\"click\", this._onDocumentClick);\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    this.hide();\r\n    if (this.menuElement && this.menuElement.parentNode) {\r\n      this.menuElement.parentNode.removeChild(this.menuElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create the menu DOM element\r\n   * @private\r\n   */\r\n  _createMenuElement() {\r\n    const menu = document.createElement(\"div\");\r\n    menu.className = \"html-overlay-node-context-menu\";\r\n\r\n    // Styling\r\n    Object.assign(menu.style, {\r\n      position: \"fixed\",\r\n      display: \"none\",\r\n      minWidth: \"180px\",\r\n      backgroundColor: \"#2a2a2e\",\r\n      border: \"1px solid #444\",\r\n      borderRadius: \"6px\",\r\n      boxShadow: \"0 4px 16px rgba(0, 0, 0, 0.4)\",\r\n      zIndex: \"10000\",\r\n      padding: \"4px 0\",\r\n      fontFamily: \"system-ui, -apple-system, sans-serif\",\r\n      fontSize: \"13px\",\r\n      color: \"#e9e9ef\",\r\n    });\r\n\r\n    document.body.appendChild(menu);\r\n    return menu;\r\n  }\r\n\r\n  /**\r\n   * Render menu items based on current target\r\n   * @private\r\n   */\r\n  _renderItems() {\r\n    this.menuElement.innerHTML = \"\";\r\n\r\n    const visibleItems = this.items.filter((item) => {\r\n      if (item.condition) {\r\n        return item.condition(this.target);\r\n      }\r\n      return true;\r\n    });\r\n\r\n    if (visibleItems.length === 0) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    visibleItems.forEach((item) => {\r\n      const itemEl = document.createElement(\"div\");\r\n      itemEl.className = \"context-menu-item\";\r\n\r\n      // Create item content wrapper\r\n      const contentWrapper = document.createElement(\"div\");\r\n      Object.assign(contentWrapper.style, {\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"space-between\",\r\n        width: \"100%\",\r\n      });\r\n\r\n      const labelEl = document.createElement(\"span\");\r\n      labelEl.textContent = item.label;\r\n      contentWrapper.appendChild(labelEl);\r\n\r\n      // Add arrow indicator if item has submenu\r\n      if (item.submenu) {\r\n        const arrow = document.createElement(\"span\");\r\n        arrow.textContent = \"▶\";\r\n        arrow.style.marginLeft = \"12px\";\r\n        arrow.style.fontSize = \"10px\";\r\n        arrow.style.opacity = \"0.7\";\r\n        contentWrapper.appendChild(arrow);\r\n      }\r\n\r\n      itemEl.appendChild(contentWrapper);\r\n\r\n      Object.assign(itemEl.style, {\r\n        padding: \"4px 8px\",\r\n        cursor: \"pointer\",\r\n        transition: \"background-color 0.15s ease\",\r\n        userSelect: \"none\",\r\n        position: \"relative\",\r\n      });\r\n\r\n      // Hover effect\r\n      itemEl.addEventListener(\"mouseenter\", () => {\r\n        itemEl.style.backgroundColor = \"#3a3a3e\";\r\n\r\n        // Clear any pending hide timeout\r\n        if (itemEl._hideTimeout) {\r\n          clearTimeout(itemEl._hideTimeout);\r\n          itemEl._hideTimeout = null;\r\n        }\r\n\r\n        // Show submenu if exists\r\n        if (item.submenu) {\r\n          this._showSubmenu(item.submenu, itemEl);\r\n        }\r\n      });\r\n\r\n      itemEl.addEventListener(\"mouseleave\", (e) => {\r\n        itemEl.style.backgroundColor = \"transparent\";\r\n\r\n        // Hide submenu with delay if moving to submenu\r\n        if (item.submenu) {\r\n          const submenuEl = itemEl._submenuElement;\r\n          if (submenuEl) {\r\n            // Add delay before hiding to allow mouse to reach submenu\r\n            itemEl._hideTimeout = setTimeout(() => {\r\n              if (!submenuEl.contains(document.elementFromPoint(e.clientX, e.clientY))) {\r\n                this._hideSubmenu(itemEl);\r\n              }\r\n            }, 150); // 150ms delay\r\n          }\r\n        }\r\n      });\r\n\r\n      // Click handler\r\n      if (!item.submenu) {\r\n        itemEl.addEventListener(\"click\", (e) => {\r\n          e.stopPropagation();\r\n          item.action(this.target);\r\n          this.hide();\r\n        });\r\n      }\r\n\r\n      this.menuElement.appendChild(itemEl);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show submenu for an item\r\n   * @private\r\n   */\r\n  _showSubmenu(submenuItems, parentItemEl) {\r\n    // Remove any existing submenu\r\n    this._hideSubmenu(parentItemEl);\r\n\r\n    const submenuEl = document.createElement(\"div\");\r\n    submenuEl.className = \"context-submenu\";\r\n\r\n    Object.assign(submenuEl.style, {\r\n      position: \"fixed\",\r\n      minWidth: \"140px\",\r\n      backgroundColor: \"#2a2a2e\",\r\n      border: \"1px solid #444\",\r\n      borderRadius: \"6px\",\r\n      boxShadow: \"0 4px 16px rgba(0, 0, 0, 0.4)\",\r\n      zIndex: \"10001\",\r\n      padding: \"4px 0\",\r\n      fontFamily: \"system-ui, -apple-system, sans-serif\",\r\n      fontSize: \"13px\",\r\n      color: \"#e9e9ef\",\r\n    });\r\n\r\n    submenuItems.forEach((subItem) => {\r\n      const subItemEl = document.createElement(\"div\");\r\n      subItemEl.className = \"context-submenu-item\";\r\n\r\n      // Create content with color swatch if available\r\n      const contentWrapper = document.createElement(\"div\");\r\n      Object.assign(contentWrapper.style, {\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        gap: \"8px\",\r\n      });\r\n\r\n      // Color swatch\r\n      if (subItem.color) {\r\n        const swatch = document.createElement(\"div\");\r\n        Object.assign(swatch.style, {\r\n          width: \"16px\",\r\n          height: \"16px\",\r\n          borderRadius: \"3px\",\r\n          backgroundColor: subItem.color,\r\n          border: \"1px solid #555\",\r\n          flexShrink: \"0\",\r\n        });\r\n        contentWrapper.appendChild(swatch);\r\n      }\r\n\r\n      const labelEl = document.createElement(\"span\");\r\n      labelEl.textContent = subItem.label;\r\n      contentWrapper.appendChild(labelEl);\r\n\r\n      subItemEl.appendChild(contentWrapper);\r\n\r\n      Object.assign(subItemEl.style, {\r\n        padding: \"4px 8px\",\r\n        cursor: \"pointer\",\r\n        transition: \"background-color 0.15s ease\",\r\n        userSelect: \"none\",\r\n      });\r\n\r\n      subItemEl.addEventListener(\"mouseenter\", () => {\r\n        subItemEl.style.backgroundColor = \"#3a3a3e\";\r\n      });\r\n\r\n      subItemEl.addEventListener(\"mouseleave\", () => {\r\n        subItemEl.style.backgroundColor = \"transparent\";\r\n      });\r\n\r\n      subItemEl.addEventListener(\"click\", (e) => {\r\n        e.stopPropagation();\r\n        subItem.action(this.target);\r\n        this.hide();\r\n      });\r\n\r\n      submenuEl.appendChild(subItemEl);\r\n    });\r\n\r\n    // Keep submenu open when hovering over it\r\n    submenuEl.addEventListener(\"mouseenter\", () => {\r\n      // Clear parent's hide timeout\r\n      if (parentItemEl._hideTimeout) {\r\n        clearTimeout(parentItemEl._hideTimeout);\r\n        parentItemEl._hideTimeout = null;\r\n      }\r\n    });\r\n\r\n    submenuEl.addEventListener(\"mouseleave\", (e) => {\r\n      if (!parentItemEl.contains(e.relatedTarget)) {\r\n        this._hideSubmenu(parentItemEl);\r\n      }\r\n    });\r\n\r\n    document.body.appendChild(submenuEl);\r\n    parentItemEl._submenuElement = submenuEl;\r\n\r\n    // Position submenu next to parent item\r\n    requestAnimationFrame(() => {\r\n      const parentRect = parentItemEl.getBoundingClientRect();\r\n      const submenuRect = submenuEl.getBoundingClientRect();\r\n\r\n      let left = parentRect.right + 2;\r\n      let top = parentRect.top;\r\n\r\n      // Adjust if submenu goes off-screen\r\n      if (left + submenuRect.width > window.innerWidth) {\r\n        left = parentRect.left - submenuRect.width - 2;\r\n      }\r\n\r\n      if (top + submenuRect.height > window.innerHeight) {\r\n        top = window.innerHeight - submenuRect.height - 5;\r\n      }\r\n\r\n      submenuEl.style.left = `${left}px`;\r\n      submenuEl.style.top = `${top}px`;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hide submenu for an item\r\n   * @private\r\n   */\r\n  _hideSubmenu(parentItemEl) {\r\n    if (parentItemEl._submenuElement) {\r\n      parentItemEl._submenuElement.remove();\r\n      parentItemEl._submenuElement = null;\r\n    }\r\n  }\r\n}\r\n","export class Runner {\r\n  constructor({ graph, registry, hooks, cyclesPerFrame = 1 }) {\r\n    this.graph = graph;\r\n    this.registry = registry;\r\n    this.hooks = hooks;\r\n    this.running = false;\r\n    this._raf = null;\r\n    this._last = 0;\r\n    this.cyclesPerFrame = Math.max(1, cyclesPerFrame | 0);\r\n  }\r\n\r\n  // 외부에서 실행 중인지 확인\r\n  isRunning() {\r\n    return this.running;\r\n  }\r\n\r\n  // 실행 도중에도 CPS 변경 가능\r\n  setCyclesPerFrame(n) {\r\n    this.cyclesPerFrame = Math.max(1, n | 0);\r\n  }\r\n\r\n  step(cycles = 1, dt = 0) {\r\n    const nCycles = Math.max(1, cycles | 0);\r\n    for (let c = 0; c < nCycles; c++) {\r\n      for (const node of this.graph.nodes.values()) {\r\n        const def = this.registry.types.get(node.type);\r\n        if (def?.onExecute) {\r\n          try {\r\n            def.onExecute(node, {\r\n              dt,\r\n              graph: this.graph,\r\n              getInput: (portName) => {\r\n                const p =\r\n                  node.inputs.find((i) => i.name === portName) ||\r\n                  node.inputs[0];\r\n                return p ? this.graph.getInput(node.id, p.id) : undefined;\r\n              },\r\n              setOutput: (portName, value) => {\r\n                const p =\r\n                  node.outputs.find((o) => o.name === portName) ||\r\n                  node.outputs[0];\r\n                if (p) this.graph.setOutput(node.id, p.id, value);\r\n              },\r\n            });\r\n          } catch (err) {\r\n            this.hooks?.emit?.(\"error\", err);\r\n          }\r\n        }\r\n      }\r\n      // commit writes for this cycle\r\n      this.graph.swapBuffers();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute connected nodes once from a starting node\r\n   * @param {string} startNodeId - ID of the node to start from\r\n   * @param {number} dt - Delta time\r\n   */\r\n  runOnce(startNodeId, dt = 0) {\r\n    console.log(\"[Runner.runOnce] Starting exec flow from node:\", startNodeId);\r\n\r\n    const executedNodes = [];\r\n    const allConnectedNodes = new Set();\r\n    let currentNodeId = startNodeId;\r\n\r\n    // Follow exec flow\r\n    while (currentNodeId) {\r\n      const node = this.graph.nodes.get(currentNodeId);\r\n      if (!node) {\r\n        console.warn(`[Runner.runOnce] Node not found: ${currentNodeId}`);\r\n        break;\r\n      }\r\n\r\n      executedNodes.push(currentNodeId);\r\n      allConnectedNodes.add(currentNodeId);\r\n      console.log(`[Runner.runOnce] Executing: ${node.title} (${node.type})`);\r\n\r\n      // Find and add data dependency nodes (nodes providing input data)\r\n      for (const input of node.inputs) {\r\n        if (input.portType === \"data\") {\r\n          // Find edge feeding this data input\r\n          for (const edge of this.graph.edges.values()) {\r\n            if (edge.toNode === currentNodeId && edge.toPort === input.id) {\r\n              const sourceNode = this.graph.nodes.get(edge.fromNode);\r\n              if (sourceNode && !allConnectedNodes.has(edge.fromNode)) {\r\n                allConnectedNodes.add(edge.fromNode);\r\n                // Execute data source node before current node\r\n                this.executeNode(edge.fromNode, dt);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Execute current node\r\n      this.executeNode(currentNodeId, dt);\r\n\r\n      // Find next node via exec output\r\n      currentNodeId = this.findNextExecNode(currentNodeId);\r\n    }\r\n\r\n    console.log(\"[Runner.runOnce] Executed nodes:\", executedNodes.length);\r\n\r\n    // Find all edges involved (both exec and data)\r\n    const connectedEdges = new Set();\r\n    for (const edge of this.graph.edges.values()) {\r\n      if (allConnectedNodes.has(edge.fromNode) && allConnectedNodes.has(edge.toNode)) {\r\n        connectedEdges.add(edge.id);\r\n      }\r\n    }\r\n\r\n    console.log(\"[Runner.runOnce] Connected edges count:\", connectedEdges.size);\r\n    return { connectedNodes: allConnectedNodes, connectedEdges };\r\n  }\r\n\r\n  /**\r\n   * Find the next node to execute by following exec output\r\n   * @param {string} nodeId - Current node ID\r\n   * @returns {string|null} Next node ID or null\r\n   */\r\n  findNextExecNode(nodeId) {\r\n    const node = this.graph.nodes.get(nodeId);\r\n    if (!node) return null;\r\n\r\n    // Find exec output port\r\n    const execOutput = node.outputs.find(p => p.portType === \"exec\");\r\n    if (!execOutput) return null;\r\n\r\n    // Find edge from exec output\r\n    for (const edge of this.graph.edges.values()) {\r\n      if (edge.fromNode === nodeId && edge.fromPort === execOutput.id) {\r\n        return edge.toNode;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Execute a single node\r\n   * @param {string} nodeId - Node ID to execute\r\n   * @param {number} dt - Delta time\r\n   */\r\n  executeNode(nodeId, dt) {\r\n    const node = this.graph.nodes.get(nodeId);\r\n    if (!node) return;\r\n\r\n    const def = this.registry.types.get(node.type);\r\n    if (!def?.onExecute) return;\r\n\r\n    try {\r\n      def.onExecute(node, {\r\n        dt,\r\n        graph: this.graph,\r\n        getInput: (portName) => {\r\n          const p = node.inputs.find((i) => i.name === portName) || node.inputs[0];\r\n          return p ? this.graph.getInput(node.id, p.id) : undefined;\r\n        },\r\n        setOutput: (portName, value) => {\r\n          const p = node.outputs.find((o) => o.name === portName) || node.outputs[0];\r\n          if (p) {\r\n            // Write directly to current buffer so other nodes can read it immediately\r\n            const key = `${node.id}:${p.id}`;\r\n            this.graph._curBuf().set(key, value);\r\n          }\r\n        },\r\n      });\r\n    } catch (err) {\r\n      this.hooks?.emit?.(\"error\", err);\r\n    }\r\n  }\r\n\r\n  start() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    this._last = 0;\r\n    this.hooks?.emit?.(\"runner:start\");\r\n\r\n    const loop = (t) => {\r\n      if (!this.running) return;\r\n      const dtMs = this._last ? t - this._last : 0;\r\n      this._last = t;\r\n      const dt = dtMs / 1000; // seconds\r\n\r\n      // 1) 스텝 실행\r\n      this.step(this.cyclesPerFrame, dt);\r\n\r\n      // 2) 프레임 훅 (렌더러/컨트롤러는 여기서 running, time, dt를 받아 표현 업데이트)\r\n      this.hooks?.emit?.(\"runner:tick\", {\r\n        time: t,\r\n        dt,\r\n        running: true,\r\n        cps: this.cyclesPerFrame,\r\n      });\r\n\r\n      this._raf = requestAnimationFrame(loop);\r\n    };\r\n\r\n    this._raf = requestAnimationFrame(loop);\r\n  }\r\n\r\n  stop() {\r\n    if (!this.running) return;\r\n    this.running = false;\r\n    if (this._raf) cancelAnimationFrame(this._raf);\r\n    this._raf = null;\r\n    this._last = 0;\r\n    this.hooks?.emit?.(\"runner:stop\");\r\n  }\r\n}\r\n","// 캔버스 위에 붙는 DOM 오버레이. 캔버스의 scale/offset에 맞춰 CSS transform을 적용.\r\n// 동기화 하기 까다로워서 아직 적용하지 않음\r\nexport class HtmlOverlay {\r\n  /**\r\n   * @param {HTMLElement} host  캔버스를 감싸는 래퍼( position: relative )\r\n   * @param {CanvasRenderer} renderer\r\n   * @param {Registry} registry\r\n   */\r\n  constructor(host, renderer, registry) {\r\n    this.host = host;\r\n    this.renderer = renderer;\r\n    this.registry = registry;\r\n    this.container = document.createElement(\"div\");\r\n    Object.assign(this.container.style, {\r\n      position: \"absolute\",\r\n      inset: \"0\",\r\n      pointerEvents: \"none\", // 기본은 통과\r\n      zIndex: \"10\",\r\n    });\r\n    host.appendChild(this.container);\r\n\r\n    /** @type {Map<string, HTMLElement>} */\r\n    this.nodes = new Map();\r\n  }\r\n\r\n  /** 기본 노드 레이아웃 생성 (헤더 + 바디) */\r\n  _createDefaultNodeLayout(node) {\r\n    const container = document.createElement(\"div\");\r\n    container.className = \"node-overlay\";\r\n    Object.assign(container.style, {\r\n      position: \"absolute\",\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      boxSizing: \"border-box\",\r\n      pointerEvents: \"none\", // 기본은 통과 (캔버스 인터랙션 위해)\r\n      overflow: \"hidden\", // 둥근 모서리 등\r\n    });\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"node-header\";\r\n    Object.assign(header.style, {\r\n      height: \"24px\",\r\n      flexShrink: \"0\",\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      padding: \"0 8px\",\r\n      cursor: \"grab\",\r\n      userSelect: \"none\",\r\n      pointerEvents: \"none\", // 헤더 클릭시 드래그는 캔버스가 처리\r\n    });\r\n\r\n    const body = document.createElement(\"div\");\r\n    body.className = \"node-body\";\r\n    Object.assign(body.style, {\r\n      flex: \"1\",\r\n      position: \"relative\",\r\n      overflow: \"hidden\",\r\n      pointerEvents: \"auto\", // 바디 내부는 인터랙션 가능하게? 아니면 이것도 none하고 자식만 auto?\r\n      // 일단 바디는 auto로 두면 바디 영역 클릭시 드래그가 안됨.\r\n      // 그래서 바디도 none으로 하고, 내부 컨텐츠(input 등)만 auto로 하는게 맞음.\r\n      pointerEvents: \"none\",\r\n    });\r\n\r\n    container.appendChild(header);\r\n    container.appendChild(body);\r\n\r\n    // 나중에 접근하기 쉽게 프로퍼티로 저장\r\n    container._domParts = { header, body };\r\n    return container;\r\n  }\r\n\r\n  /** 노드용 엘리먼트 생성(한 번만) */\r\n  _ensureNodeElement(node, def) {\r\n    let el = this.nodes.get(node.id);\r\n    if (!el) {\r\n      // 1) 사용자 정의 render 함수가 있으면 우선 사용\r\n      if (def.html?.render) {\r\n        el = def.html.render(node);\r\n      }\r\n      // 2) 아니면 기본 레이아웃 사용 (html 설정이 있는 경우)\r\n      else if (def.html) {\r\n        el = this._createDefaultNodeLayout(node);\r\n        // 초기화 훅\r\n        if (def.html.init) {\r\n          def.html.init(node, el, el._domParts);\r\n        }\r\n      } else {\r\n        return null; // HTML 없음\r\n      }\r\n\r\n      if (!el) return null;\r\n\r\n      el.style.position = \"absolute\";\r\n      el.style.pointerEvents = \"none\"; // 기본적으로 캔버스 통과\r\n      this.container.appendChild(el);\r\n      this.nodes.set(node.id, el);\r\n    }\r\n    return el;\r\n  }\r\n\r\n  /** 그래프와 변환 동기화하여 렌더링 */\r\n  draw(graph, selection = new Set()) {\r\n    // 컨테이너 전체에 월드 변환 적용 (CSS 픽셀 기준)\r\n    const { scale, offsetX, offsetY } = this.renderer;\r\n    this.container.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;\r\n    this.container.style.transformOrigin = \"0 0\";\r\n\r\n    const seen = new Set();\r\n\r\n    for (const node of graph.nodes.values()) {\r\n      const def = this.registry.types.get(node.type);\r\n\r\n      // render 함수가 있거나, html 설정 객체가 있으면 처리\r\n      const hasHtml = !!(def?.html);\r\n      if (!hasHtml) continue;\r\n\r\n      const el = this._ensureNodeElement(node, def);\r\n      if (!el) continue;\r\n\r\n      // 노드 위치/크기 동기화 (월드 좌표 → 컨테이너 내부는 이미 scale/translate 적용)\r\n      el.style.left = `${node.computed.x}px`;\r\n      el.style.top = `${node.computed.y}px`;\r\n      el.style.width = `${node.computed.w}px`;\r\n      el.style.height = `${node.computed.h}px`;\r\n\r\n      // 선택 상태 등 업데이트 훅\r\n      if (def.html.update) {\r\n        // 기본 레이아웃이면 header/body도 함께 전달\r\n        const parts = el._domParts || {};\r\n        def.html.update(node, el, {\r\n          selected: selection.has(node.id),\r\n          header: parts.header,\r\n          body: parts.body\r\n        });\r\n      }\r\n\r\n      seen.add(node.id);\r\n    }\r\n\r\n    // 없어진 노드 제거\r\n    for (const [id, el] of this.nodes) {\r\n      if (!seen.has(id)) {\r\n        el.remove();\r\n        this.nodes.delete(id);\r\n      }\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    // Remove all node elements\r\n    for (const [, el] of this.nodes) {\r\n      el.remove();\r\n    }\r\n    this.nodes.clear();\r\n  }\r\n\r\n  destroy() {\r\n    this.clear();\r\n    this.container.remove();\r\n  }\r\n}\r\n","/**\r\n * Minimap - Shows overview of entire graph with viewport indicator\r\n */\r\nexport class Minimap {\r\n    constructor(container, { graph, renderer, width = 200, height = 150 } = {}) {\r\n        this.graph = graph;\r\n        this.renderer = renderer;\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        // Create canvas element\r\n        this.canvas = document.createElement(\"canvas\");\r\n        this.canvas.id = \"minimap\";\r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n        this.canvas.style.position = \"fixed\";\r\n        this.canvas.style.bottom = \"20px\";\r\n        this.canvas.style.right = \"20px\";\r\n        this.canvas.style.border = \"2px solid #444\";\r\n        this.canvas.style.borderRadius = \"8px\";\r\n        this.canvas.style.background = \"rgba(20, 20, 23, 0.9)\";\r\n        this.canvas.style.boxShadow = \"0 4px 12px rgba(0, 0, 0, 0.5)\";\r\n        this.canvas.style.pointerEvents = \"none\"; // Don't block clicks\r\n\r\n        this.ctx = this.canvas.getContext(\"2d\");\r\n\r\n        // Add to container\r\n        container.appendChild(this.canvas);\r\n    }\r\n\r\n    /**\r\n     * Render the minimap\r\n     */\r\n    render() {\r\n        const { graph, renderer, ctx, width: w, height: h } = this;\r\n\r\n        // Clear\r\n        ctx.fillStyle = \"#141417\";\r\n        ctx.fillRect(0, 0, w, h);\r\n\r\n        if (graph.nodes.size === 0) return;\r\n\r\n        // Calculate bounds of all nodes\r\n        let minX = Infinity,\r\n            minY = Infinity,\r\n            maxX = -Infinity,\r\n            maxY = -Infinity;\r\n        for (const node of graph.nodes.values()) {\r\n            const { x, y, w: nw, h: nh } = node.computed;\r\n            minX = Math.min(minX, x);\r\n            minY = Math.min(minY, y);\r\n            maxX = Math.max(maxX, x + nw);\r\n            maxY = Math.max(maxY, y + nh);\r\n        }\r\n\r\n        // Add margin to the bounds\r\n        const margin = 100; // World units margin\r\n        const graphWidth = Math.max(300, maxX - minX + margin * 2);\r\n        const graphHeight = Math.max(200, maxY - minY + margin * 2);\r\n\r\n        // Adjust minX and minY to center the content\r\n        minX -= margin;\r\n        minY -= margin;\r\n\r\n        const padding = 10;\r\n\r\n        const scale = Math.min(\r\n            (w - padding * 2) / graphWidth,\r\n            (h - padding * 2) / graphHeight\r\n        );\r\n\r\n        const offsetX = (w - graphWidth * scale) / 2;\r\n        const offsetY = (h - graphHeight * scale) / 2;\r\n\r\n        // Draw edges first (so they appear behind nodes)\r\n        ctx.strokeStyle = \"rgba(127, 140, 255, 0.5)\"; // Semi-transparent edge color\r\n        ctx.lineWidth = 1;\r\n        for (const edge of graph.edges.values()) {\r\n            const fromNode = graph.nodes.get(edge.fromNode);\r\n            const toNode = graph.nodes.get(edge.toNode);\r\n            if (!fromNode || !toNode) continue;\r\n\r\n            // Get center points of nodes\r\n            const x1 = fromNode.computed.x + fromNode.computed.w / 2;\r\n            const y1 = fromNode.computed.y + fromNode.computed.h / 2;\r\n            const x2 = toNode.computed.x + toNode.computed.w / 2;\r\n            const y2 = toNode.computed.y + toNode.computed.h / 2;\r\n\r\n            // Transform to minimap coordinates\r\n            const mx1 = (x1 - minX) * scale + offsetX;\r\n            const my1 = (y1 - minY) * scale + offsetY;\r\n            const mx2 = (x2 - minX) * scale + offsetX;\r\n            const my2 = (y2 - minY) * scale + offsetY;\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(mx1, my1);\r\n            ctx.lineTo(mx2, my2);\r\n            ctx.stroke();\r\n        }\r\n\r\n        // Draw nodes\r\n        ctx.fillStyle = \"#6cf\";\r\n        for (const node of graph.nodes.values()) {\r\n            const { x, y, w: nw, h: nh } = node.computed;\r\n            const mx = (x - minX) * scale + offsetX;\r\n            const my = (y - minY) * scale + offsetY;\r\n            const mw = nw * scale;\r\n            const mh = nh * scale;\r\n\r\n            if (node.type === \"core/Group\") {\r\n                ctx.fillStyle = \"rgba(102, 204, 255, 0.2)\";\r\n                ctx.strokeStyle = \"#6cf\";\r\n                ctx.lineWidth = 1;\r\n                ctx.fillRect(mx, my, mw, mh);\r\n                ctx.strokeRect(mx, my, mw, mh);\r\n            } else {\r\n                ctx.fillStyle = \"#6cf\";\r\n                ctx.fillRect(mx, my, Math.max(2, mw), Math.max(2, mh));\r\n            }\r\n        }\r\n\r\n        // Draw viewport rectangle\r\n        const vx0 = -renderer.offsetX / renderer.scale;\r\n        const vy0 = -renderer.offsetY / renderer.scale;\r\n        const vw = renderer.canvas.width / renderer.scale;\r\n        const vh = renderer.canvas.height / renderer.scale;\r\n\r\n        const vmx = (vx0 - minX) * scale + offsetX;\r\n        const vmy = (vy0 - minY) * scale + offsetY;\r\n        const vmw = vw * scale;\r\n        const vmh = vh * scale;\r\n\r\n        ctx.strokeStyle = \"#ff6b6b\";\r\n        ctx.lineWidth = 2;\r\n        ctx.strokeRect(vmx, vmy, vmw, vmh);\r\n    }\r\n\r\n    /**\r\n     * Cleanup\r\n     */\r\n    destroy() {\r\n        if (this.canvas.parentElement) {\r\n            this.canvas.parentElement.removeChild(this.canvas);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * PropertyPanel - Node property editor panel\r\n */\r\nexport class PropertyPanel {\r\n  constructor(container, { graph, hooks, registry, render }) {\r\n    this.container = container;\r\n    this.graph = graph;\r\n    this.hooks = hooks;\r\n    this.registry = registry;\r\n    this.render = render; // Store render callback\r\n\r\n    this.panel = null;\r\n    this.currentNode = null;\r\n    this.isVisible = false;\r\n\r\n    this._createPanel();\r\n  }\r\n\r\n  _createPanel() {\r\n    // Create panel element\r\n    this.panel = document.createElement('div');\r\n    this.panel.className = 'property-panel';\r\n    this.panel.style.display = 'none';\r\n\r\n    // Panel HTML structure\r\n    this.panel.innerHTML = `\r\n      <div class=\"panel-inner\">\r\n        <div class=\"panel-header\">\r\n          <div class=\"panel-title\">\r\n            <span class=\"title-text\">Node Properties</span>\r\n          </div>\r\n          <button class=\"panel-close\" type=\"button\">×</button>\r\n        </div>\r\n        <div class=\"panel-content\">\r\n          <!-- Content will be dynamically generated -->\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.container.appendChild(this.panel);\r\n\r\n    // Event listeners\r\n    this.panel.querySelector('.panel-close').addEventListener('click', () => {\r\n      this.close();\r\n    });\r\n\r\n    // Close on ESC key\r\n    document.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape' && this.isVisible) {\r\n        this.close();\r\n      }\r\n    });\r\n  }\r\n\r\n  open(node) {\r\n    if (!node) return;\r\n\r\n    this.currentNode = node;\r\n    this.isVisible = true;\r\n\r\n    // Update content\r\n    this._renderContent();\r\n\r\n    // Show panel\r\n    this.panel.style.display = 'block';\r\n    this.panel.classList.add('panel-visible');\r\n  }\r\n\r\n  close() {\r\n    this.isVisible = false;\r\n    this.panel.classList.remove('panel-visible');\r\n\r\n    setTimeout(() => {\r\n      this.panel.style.display = 'none';\r\n      this.currentNode = null;\r\n    }, 200);\r\n  }\r\n\r\n  _renderContent() {\r\n    const node = this.currentNode;\r\n    if (!node) return;\r\n\r\n    const content = this.panel.querySelector('.panel-content');\r\n    const def = this.registry?.types?.get(node.type);\r\n\r\n    content.innerHTML = `\r\n      <div class=\"section\">\r\n        <div class=\"section-title\">Basic Info</div>\r\n        <div class=\"section-body\">\r\n          <div class=\"field\">\r\n            <label>Type</label>\r\n            <input type=\"text\" value=\"${node.type}\" readonly />\r\n          </div>\r\n          <div class=\"field\">\r\n            <label>Title</label>\r\n            <input type=\"text\" data-field=\"title\" value=\"${node.title || ''}\" />\r\n          </div>\r\n          <div class=\"field\">\r\n            <label>ID</label>\r\n            <input type=\"text\" value=\"${node.id}\" readonly />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"section\">\r\n        <div class=\"section-title\">Position & Size</div>\r\n        <div class=\"section-body\">\r\n          <div class=\"field-row\">\r\n            <div class=\"field\">\r\n              <label>X</label>\r\n              <input type=\"number\" data-field=\"x\" value=\"${Math.round(node.computed.x)}\" />\r\n            </div>\r\n            <div class=\"field\">\r\n              <label>Y</label>\r\n              <input type=\"number\" data-field=\"y\" value=\"${Math.round(node.computed.y)}\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"field-row\">\r\n            <div class=\"field\">\r\n              <label>Width</label>\r\n              <input type=\"number\" data-field=\"width\" value=\"${node.computed.w}\" />\r\n            </div>\r\n            <div class=\"field\">\r\n              <label>Height</label>\r\n              <input type=\"number\" data-field=\"height\" value=\"${node.computed.h}\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      ${this._renderPorts(node)}\r\n      ${this._renderState(node)}\r\n      \r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn-secondary panel-close-btn\">Close</button>\r\n      </div>\r\n    `;\r\n\r\n    // Add event listeners for inputs\r\n    this._attachInputListeners();\r\n  }\r\n\r\n  _renderPorts(node) {\r\n    if (!node.inputs.length && !node.outputs.length) return '';\r\n\r\n    return `\r\n      <div class=\"section\">\r\n        <div class=\"section-title\">Ports</div>\r\n        <div class=\"section-body\">\r\n          ${node.inputs.length ? `\r\n            <div class=\"port-group\">\r\n              <div class=\"port-group-title\">Inputs (${node.inputs.length})</div>\r\n              ${node.inputs.map(p => `\r\n                <div class=\"port-item\">\r\n                  <span class=\"port-icon ${p.portType || 'data'}\"></span>\r\n                  <span class=\"port-name\">${p.name}</span>\r\n                  ${p.datatype ? `<span class=\"port-type\">${p.datatype}</span>` : ''}\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          ` : ''}\r\n          \r\n          ${node.outputs.length ? `\r\n            <div class=\"port-group\">\r\n              <div class=\"port-group-title\">Outputs (${node.outputs.length})</div>\r\n              ${node.outputs.map(p => `\r\n                <div class=\"port-item\">\r\n                  <span class=\"port-icon ${p.portType || 'data'}\"></span>\r\n                  <span class=\"port-name\">${p.name}</span>\r\n                  ${p.datatype ? `<span class=\"port-type\">${p.datatype}</span>` : ''}\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  _renderState(node) {\r\n    if (!node.state || Object.keys(node.state).length === 0) return '';\r\n\r\n    return `\r\n      <div class=\"section\">\r\n        <div class=\"section-title\">State</div>\r\n        <div class=\"section-body\">\r\n          ${Object.entries(node.state).map(([key, value]) => `\r\n            <div class=\"field\">\r\n              <label>${key}</label>\r\n              <input \r\n                type=\"${typeof value === 'number' ? 'number' : 'text'}\" \r\n                data-field=\"state.${key}\" \r\n                value=\"${value}\" \r\n              />\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  _attachInputListeners() {\r\n    const inputs = this.panel.querySelectorAll('[data-field]');\r\n\r\n    inputs.forEach(input => {\r\n      input.addEventListener('change', () => {\r\n        this._handleFieldChange(input.dataset.field, input.value);\r\n      });\r\n    });\r\n\r\n    // Close button\r\n    this.panel.querySelector('.panel-close-btn').addEventListener('click', () => {\r\n      this.close();\r\n    });\r\n  }\r\n\r\n  _handleFieldChange(field, value) {\r\n    const node = this.currentNode;\r\n    if (!node) return;\r\n\r\n    switch (field) {\r\n      case 'title':\r\n        node.title = value;\r\n        break;\r\n\r\n      case 'x':\r\n        node.pos.x = parseFloat(value);\r\n        this.graph.updateWorldTransforms();\r\n        break;\r\n\r\n      case 'y':\r\n        node.pos.y = parseFloat(value);\r\n        this.graph.updateWorldTransforms();\r\n        break;\r\n\r\n      case 'width':\r\n        node.size.width = parseFloat(value);\r\n        break;\r\n\r\n      case 'height':\r\n        node.size.height = parseFloat(value);\r\n        break;\r\n\r\n      default:\r\n        // Handle state fields\r\n        if (field.startsWith('state.')) {\r\n          const key = field.substring(6);\r\n          if (node.state) {\r\n            const originalValue = node.state[key];\r\n            node.state[key] = typeof originalValue === 'number' ? parseFloat(value) : value;\r\n          }\r\n        }\r\n    }\r\n\r\n    // Emit update event\r\n    this.hooks?.emit('node:updated', node);\r\n\r\n    // Trigger render to update canvas immediately\r\n    if (this.render) {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    if (this.panel) {\r\n      this.panel.remove();\r\n    }\r\n  }\r\n}\r\n","import { Registry } from \"./core/Registry.js\";\r\nimport { createHooks } from \"./core/Hooks.js\";\r\nimport { Graph } from \"./core/Graph.js\";\r\nimport { CanvasRenderer } from \"./render/CanvasRenderer.js\";\r\nimport { Controller } from \"./interact/Controller.js\";\r\nimport { ContextMenu } from \"./interact/ContextMenu.js\";\r\nimport { Runner } from \"./core/Runner.js\";\r\n\r\nimport { HtmlOverlay } from \"./render/HtmlOverlay.js\";\r\nimport { RemoveNodeCmd, ChangeGroupColorCmd } from \"./core/commands.js\";\r\nimport { Minimap } from \"./minimap/Minimap.js\";\r\nimport { PropertyPanel } from \"./ui/PropertyPanel.js\";\r\n\r\n\r\n\r\nexport function createGraphEditor(\r\n  target,\r\n  {\r\n    theme,\r\n    hooks: customHooks,\r\n    autorun = true,\r\n    showMinimap = true,\r\n    enablePropertyPanel = true,\r\n    propertyPanelContainer = null,\r\n  } = {}\r\n) {\r\n  let canvas;\r\n  let container;\r\n\r\n  if (typeof target === \"string\") {\r\n    target = document.querySelector(target);\r\n  }\r\n\r\n  if (!target) {\r\n    throw new Error(\"createGraphEditor: target element not found\");\r\n  }\r\n\r\n  if (target instanceof HTMLCanvasElement) {\r\n    canvas = target;\r\n    container = canvas.parentElement;\r\n  } else {\r\n    container = target;\r\n    canvas = container.querySelector(\"canvas\");\r\n    if (!canvas) {\r\n      canvas = document.createElement(\"canvas\");\r\n      canvas.style.display = \"block\";\r\n      canvas.style.width = \"100%\";\r\n      canvas.style.height = \"100%\";\r\n      container.appendChild(canvas);\r\n    }\r\n  }\r\n\r\n  // Ensure container has relative positioning for overlays\r\n  if (getComputedStyle(container).position === \"static\") {\r\n    container.style.position = \"relative\";\r\n  }\r\n  const hooks =\r\n    customHooks ??\r\n    createHooks([\r\n      // essential hooks\r\n      \"node:create\",\r\n      \"node:move\",\r\n      \"node:click\",\r\n      \"node:dblclick\",\r\n      \"edge:create\",\r\n      \"edge:delete\",\r\n      \"graph:serialize\",\r\n      \"graph:deserialize\",\r\n      \"error\",\r\n      \"runner:tick\",\r\n      \"runner:start\",\r\n      \"runner:stop\",\r\n      \"node:resize\",\r\n      \"group:change\",\r\n      \"node:updated\",\r\n    ]);\r\n  const registry = new Registry();\r\n  const graph = new Graph({ hooks, registry });\r\n  const renderer = new CanvasRenderer(canvas, { theme, registry });\r\n  // HTML Overlay\r\n  const htmlOverlay = new HtmlOverlay(canvas.parentElement, renderer, registry);\r\n\r\n  // Port Canvas (above HTML overlay)\r\n  const portCanvas = document.createElement(\"canvas\");\r\n  portCanvas.id = \"port-canvas\";\r\n  Object.assign(portCanvas.style, {\r\n    position: \"absolute\",\r\n    top: \"0\",\r\n    left: \"0\",\r\n    pointerEvents: \"none\", // Pass through clicks\r\n    zIndex: \"20\", // Above HTML overlay (z-index 10)\r\n  });\r\n  canvas.parentElement.appendChild(portCanvas);\r\n\r\n  // Create port renderer (shares transform with main renderer)\r\n  const portRenderer = new CanvasRenderer(portCanvas, { theme, registry });\r\n  portRenderer.setTransform = renderer.setTransform.bind(renderer);\r\n  portRenderer.scale = renderer.scale;\r\n  portRenderer.offsetX = renderer.offsetX;\r\n  portRenderer.offsetY = renderer.offsetY;\r\n\r\n  const controller = new Controller({ graph, renderer, hooks, htmlOverlay, portRenderer });\r\n\r\n  // Create context menu after controller (needs commandStack)\r\n  const contextMenu = new ContextMenu({\r\n    graph,\r\n    hooks,\r\n    renderer,\r\n    commandStack: controller.stack,\r\n  });\r\n\r\n  // Connect context menu to controller\r\n  controller.contextMenu = contextMenu;\r\n\r\n  // Create minimap if enabled\r\n  let minimap = null;\r\n  if (showMinimap) {\r\n    minimap = new Minimap(container, { graph, renderer });\r\n  }\r\n\r\n  // Initialize Property Panel if enabled\r\n  let propertyPanel = null;\r\n  if (enablePropertyPanel) {\r\n    propertyPanel = new PropertyPanel(propertyPanelContainer || container, {\r\n      graph,\r\n      hooks,\r\n      registry,\r\n      render: () => controller.render(),\r\n    });\r\n\r\n    // Handle node double-click to open property panel\r\n    hooks.on(\"node:dblclick\", (node) => {\r\n      propertyPanel.open(node);\r\n    });\r\n  }\r\n\r\n  const runner = new Runner({ graph, registry, hooks });\r\n\r\n  hooks.on(\"runner:tick\", ({ time, dt }) => {\r\n    renderer.draw(graph, {\r\n      selection: controller.selection,\r\n      tempEdge: controller.connecting ? controller.renderTempEdge() : null, // 필요시 helper\r\n      running: true,\r\n      time,\r\n      dt,\r\n    });\r\n    htmlOverlay.draw(graph, controller.selection);\r\n  });\r\n  hooks.on(\"runner:start\", () => {\r\n    // 첫 프레임 즉시 렌더\r\n    renderer.draw(graph, {\r\n      selection: controller.selection,\r\n      tempEdge: controller.connecting ? controller.renderTempEdge() : null,\r\n      running: true,\r\n      time: performance.now(),\r\n      dt: 0,\r\n    });\r\n    htmlOverlay.draw(graph, controller.selection);\r\n  });\r\n  hooks.on(\"runner:stop\", () => {\r\n    // 정지 프레임\r\n    renderer.draw(graph, {\r\n      selection: controller.selection,\r\n      tempEdge: controller.connecting ? controller.renderTempEdge() : null,\r\n      running: false,\r\n      time: performance.now(),\r\n      dt: 0,\r\n    });\r\n    htmlOverlay.draw(graph, controller.selection);\r\n  });\r\n\r\n  hooks.on(\"node:updated\", () => {\r\n    controller.render();\r\n  });\r\n\r\n  // default node\r\n  registry.register(\"core/Note\", {\r\n    title: \"Note\",\r\n    size: { w: 180, h: 80 },\r\n    inputs: [{ name: \"in\", datatype: \"any\" }],\r\n    outputs: [{ name: \"out\", datatype: \"any\" }],\r\n    onCreate(node) {\r\n      node.state.text = \"hello\";\r\n    },\r\n    onExecute(node, { dt, getInput, setOutput }) {\r\n      // Simple passthrough with uppercase and a heartbeat value\r\n      const incoming = getInput(\"in\");\r\n      const out = (incoming ?? node.state.text ?? \"\").toString().toUpperCase();\r\n      setOutput(\r\n        \"out\",\r\n        out + ` · ${Math.floor((performance.now() / 1000) % 100)}`\r\n      );\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const pr = 8;\r\n      const { x, y } = node.pos;\r\n      const { width: w } = node.size;\r\n      const lx = x + pr; // 월드 x\r\n      const ly = y + 24 + 6; // 타이틀 바(24) 아래 여백 6\r\n      // renderer._drawScreenText(node.state.text ?? \"hello\", lx, ly, {\r\n      //   fontPx: 11,\r\n      //   color: theme.text,\r\n      //   baseline: \"top\",\r\n      //   align: \"left\",\r\n      // });\r\n    },\r\n  });\r\n\r\n  // HTML Custom Node Example\r\n  registry.register(\"core/HtmlNote\", {\r\n    title: \"HTML Note\",\r\n    size: { w: 200, h: 150 },\r\n    inputs: [{ name: \"in\", datatype: \"any\" }],\r\n    outputs: [{ name: \"out\", datatype: \"any\" }],\r\n\r\n    // HTML Overlay Configuration\r\n    html: {\r\n      // 초기화: 헤더/바디 구성\r\n      init(node, el, { header, body }) {\r\n        el.style.backgroundColor = \"#222\";\r\n        el.style.borderRadius = \"8px\";\r\n        el.style.border = \"1px solid #444\";\r\n        el.style.boxShadow = \"0 4px 12px rgba(0,0,0,0.3)\";\r\n\r\n        // Header\r\n        header.style.backgroundColor = \"#333\";\r\n        header.style.borderBottom = \"1px solid #444\";\r\n        header.style.color = \"#eee\";\r\n        header.style.fontSize = \"12px\";\r\n        header.style.fontWeight = \"bold\";\r\n        header.textContent = \"My HTML Node\";\r\n\r\n        // Body\r\n        body.style.padding = \"8px\";\r\n        body.style.color = \"#ccc\";\r\n        body.style.fontSize = \"12px\";\r\n\r\n        const contentDiv = document.createElement(\"div\");\r\n        contentDiv.textContent = \"Event Name\";\r\n        body.appendChild(contentDiv);\r\n\r\n        // Add some interactive content\r\n        const input = document.createElement(\"input\");\r\n        Object.assign(input.style, {\r\n          marginTop: \"4px\",\r\n          padding: \"4px\",\r\n          background: \"#111\",\r\n          border: \"1px solid #555\",\r\n          color: \"#fff\",\r\n          borderRadius: \"4px\",\r\n          pointerEvents: \"auto\",\r\n        });\r\n        input.placeholder = \"Type here...\";\r\n        input.addEventListener(\"input\", (e) => {\r\n          node.state.text = e.target.value;\r\n        });\r\n        input.addEventListener(\"mousedown\", (e) => e.stopPropagation()); // 캔버스 드래그 방지\r\n\r\n        body.appendChild(input);\r\n\r\n        // Store input ref for updates\r\n        el._input = input;\r\n      },\r\n\r\n      // 매 프레임(또는 필요시) 업데이트\r\n      update(node, el, { header, body, selected }) {\r\n        el.style.borderColor = selected ? \"#6cf\" : \"#444\";\r\n        header.style.backgroundColor = selected ? \"#3a4a5a\" : \"#333\";\r\n\r\n        // 상태 동기화 (외부에서 변경되었을 경우)\r\n        if (el._input.value !== (node.state.text || \"\")) {\r\n          el._input.value = node.state.text || \"\";\r\n        }\r\n      }\r\n    },\r\n\r\n    onCreate(node) {\r\n      node.state.text = \"\";\r\n    },\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const incoming = getInput(\"in\");\r\n      setOutput(\"out\", incoming);\r\n    },\r\n    // onDraw는 생략 가능 (HTML이 덮으니까)\r\n    // 하지만 포트 등은 그려야 할 수도 있음. \r\n    // 현재 구조상 CanvasRenderer가 기본 노드를 그리므로, \r\n    // 투명하게 하거나 겹쳐서 그릴 수 있음.\r\n  });\r\n\r\n  // Todo List Node Example (HTML Overlay)\r\n  registry.register(\"core/TodoNode\", {\r\n    title: \"Todo List\",\r\n    size: { w: 240, h: 300 },\r\n    inputs: [{ name: \"in\", datatype: \"any\" }],\r\n    outputs: [{ name: \"out\", datatype: \"any\" }],\r\n    html: {\r\n      init(node, el, { header, body }) {\r\n        el.style.backgroundColor = \"#1e1e24\";\r\n        el.style.borderRadius = \"8px\";\r\n        el.style.boxShadow = \"0 4px 12px rgba(0,0,0,0.5)\";\r\n        el.style.border = \"1px solid #333\";\r\n\r\n        header.style.backgroundColor = \"#2a2a31\";\r\n        header.style.padding = \"8px\";\r\n        header.style.fontWeight = \"bold\";\r\n        header.style.color = \"#e9e9ef\";\r\n        header.textContent = node.title;\r\n\r\n        body.style.display = \"flex\";\r\n        body.style.flexDirection = \"column\";\r\n        body.style.padding = \"8px\";\r\n        body.style.color = \"#e9e9ef\";\r\n\r\n        // Input Area\r\n        const inputRow = document.createElement(\"div\");\r\n        Object.assign(inputRow.style, { display: \"flex\", gap: \"4px\", marginBottom: \"8px\" });\r\n\r\n        const input = document.createElement(\"input\");\r\n        Object.assign(input.style, {\r\n          flex: \"1\", padding: \"6px\", borderRadius: \"4px\",\r\n          border: \"1px solid #444\", background: \"#141417\", color: \"#fff\",\r\n          pointerEvents: \"auto\",\r\n        });\r\n        input.placeholder = \"Add task...\";\r\n\r\n        const addBtn = document.createElement(\"button\");\r\n        addBtn.textContent = \"+\";\r\n        Object.assign(addBtn.style, {\r\n          padding: \"0 12px\", cursor: \"pointer\", background: \"#4f5b66\",\r\n          color: \"#fff\", border: \"none\", borderRadius: \"4px\",\r\n          pointerEvents: \"auto\",\r\n        });\r\n\r\n        inputRow.append(input, addBtn);\r\n\r\n        // List Area\r\n        const list = document.createElement(\"ul\");\r\n        Object.assign(list.style, {\r\n          listStyle: \"none\", padding: \"0\", margin: \"0\",\r\n          overflow: \"hidden\", flex: \"1\"\r\n        });\r\n\r\n        body.append(inputRow, list);\r\n\r\n        // Logic\r\n        const addTodo = () => {\r\n          const text = input.value.trim();\r\n          if (!text) return;\r\n          const todos = node.state.todos || [];\r\n          node.state.todos = [...todos, { id: Date.now(), text, done: false }];\r\n          input.value = \"\";\r\n          hooks.emit(\"node:updated\", node);\r\n        };\r\n\r\n        addBtn.onclick = addTodo;\r\n        input.onkeydown = (e) => {\r\n          if (e.key === \"Enter\") addTodo();\r\n          e.stopPropagation();\r\n        };\r\n        input.onmousedown = (e) => e.stopPropagation(); // prevent drag\r\n\r\n        el._refs = { list };\r\n      },\r\n      update(node, el, { selected }) {\r\n        el.style.borderColor = selected ? \"#6cf\" : \"#333\";\r\n\r\n        const { list } = el._refs;\r\n        const todos = node.state.todos || [];\r\n\r\n        // Re-render list (simple approach)\r\n        list.innerHTML = \"\";\r\n        todos.forEach((todo) => {\r\n          const li = document.createElement(\"li\");\r\n          Object.assign(li.style, {\r\n            display: \"flex\", alignItems: \"center\", padding: \"6px 0\",\r\n            borderBottom: \"1px solid #2a2a31\"\r\n          });\r\n\r\n          const chk = document.createElement(\"input\");\r\n          chk.type = \"checkbox\";\r\n          chk.checked = todo.done;\r\n          chk.style.marginRight = \"8px\";\r\n          chk.style.pointerEvents = \"auto\";\r\n          chk.onchange = () => {\r\n            todo.done = chk.checked;\r\n            hooks.emit(\"node:updated\", node);\r\n          };\r\n          chk.onmousedown = (e) => e.stopPropagation();\r\n\r\n          const span = document.createElement(\"span\");\r\n          span.textContent = todo.text;\r\n          span.style.flex = \"1\";\r\n          span.style.textDecoration = todo.done ? \"line-through\" : \"none\";\r\n          span.style.color = todo.done ? \"#777\" : \"#eee\";\r\n\r\n          const del = document.createElement(\"button\");\r\n          del.textContent = \"×\";\r\n          Object.assign(del.style, {\r\n            background: \"none\", border: \"none\", color: \"#f44\",\r\n            cursor: \"pointer\", fontSize: \"16px\",\r\n            pointerEvents: \"auto\",\r\n          });\r\n          del.onclick = () => {\r\n            node.state.todos = node.state.todos.filter((t) => t.id !== todo.id);\r\n            hooks.emit(\"node:updated\", node);\r\n          };\r\n          del.onmousedown = (e) => e.stopPropagation();\r\n\r\n          li.append(chk, span, del);\r\n          list.appendChild(li);\r\n        });\r\n      }\r\n    },\r\n    onCreate(node) {\r\n      node.state.todos = [\r\n        { id: 1, text: \"Welcome to Free Node\", done: false },\r\n        { id: 2, text: \"Try adding a task\", done: true },\r\n      ];\r\n    },\r\n  });\r\n\r\n  // ===== MATH NODES =====\r\n  registry.register(\"math/Add\", {\r\n    title: \"Add\",\r\n    size: { w: 140, h: 100 },\r\n    inputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"a\", portType: \"data\", datatype: \"number\" },\r\n      { name: \"b\", portType: \"data\", datatype: \"number\" },\r\n    ],\r\n    outputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"result\", portType: \"data\", datatype: \"number\" },\r\n    ],\r\n    onCreate(node) {\r\n      node.state.a = 0;\r\n      node.state.b = 0;\r\n    },\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? 0;\r\n      const b = getInput(\"b\") ?? 0;\r\n      const result = a + b;\r\n      console.log(\"[Add] a:\", a, \"b:\", b, \"result:\", result);\r\n      setOutput(\"result\", result);\r\n    },\r\n  });\r\n\r\n  registry.register(\"math/Subtract\", {\r\n    title: \"Subtract\",\r\n    size: { w: 140, h: 80 },\r\n    inputs: [\r\n      { name: \"a\", datatype: \"number\" },\r\n      { name: \"b\", datatype: \"number\" },\r\n    ],\r\n    outputs: [{ name: \"result\", datatype: \"number\" }],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? 0;\r\n      const b = getInput(\"b\") ?? 0;\r\n      setOutput(\"result\", a - b);\r\n    },\r\n  });\r\n\r\n  registry.register(\"math/Multiply\", {\r\n    title: \"Multiply\",\r\n    size: { w: 140, h: 100 },\r\n    inputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"a\", portType: \"data\", datatype: \"number\" },\r\n      { name: \"b\", portType: \"data\", datatype: \"number\" },\r\n    ],\r\n    outputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"result\", portType: \"data\", datatype: \"number\" },\r\n    ],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? 0;\r\n      const b = getInput(\"b\") ?? 0;\r\n      const result = a * b;\r\n      console.log(\"[Multiply] a:\", a, \"b:\", b, \"result:\", result);\r\n      setOutput(\"result\", result);\r\n    },\r\n  });\r\n\r\n  registry.register(\"math/Divide\", {\r\n    title: \"Divide\",\r\n    size: { w: 140, h: 80 },\r\n    inputs: [\r\n      { name: \"a\", datatype: \"number\" },\r\n      { name: \"b\", datatype: \"number\" },\r\n    ],\r\n    outputs: [{ name: \"result\", datatype: \"number\" }],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? 0;\r\n      const b = getInput(\"b\") ?? 1;\r\n      setOutput(\"result\", b !== 0 ? a / b : 0);\r\n    },\r\n  });\r\n\r\n  // ===== LOGIC NODES =====\r\n  registry.register(\"logic/AND\", {\r\n    title: \"AND\",\r\n    size: { w: 120, h: 100 },\r\n    inputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"a\", portType: \"data\", datatype: \"boolean\" },\r\n      { name: \"b\", portType: \"data\", datatype: \"boolean\" },\r\n    ],\r\n    outputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"result\", portType: \"data\", datatype: \"boolean\" },\r\n    ],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? false;\r\n      const b = getInput(\"b\") ?? false;\r\n      console.log(\"[AND] Inputs - a:\", a, \"b:\", b);\r\n      const result = a && b;\r\n      console.log(\"[AND] Result:\", result);\r\n      setOutput(\"result\", result);\r\n    },\r\n  });\r\n\r\n  registry.register(\"logic/OR\", {\r\n    title: \"OR\",\r\n    size: { w: 120, h: 80 },\r\n    inputs: [\r\n      { name: \"a\", datatype: \"boolean\" },\r\n      { name: \"b\", datatype: \"boolean\" },\r\n    ],\r\n    outputs: [{ name: \"result\", datatype: \"boolean\" }],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const a = getInput(\"a\") ?? false;\r\n      const b = getInput(\"b\") ?? false;\r\n      setOutput(\"result\", a || b);\r\n    },\r\n  });\r\n\r\n  registry.register(\"logic/NOT\", {\r\n    title: \"NOT\",\r\n    size: { w: 120, h: 70 },\r\n    inputs: [{ name: \"in\", datatype: \"boolean\" }],\r\n    outputs: [{ name: \"out\", datatype: \"boolean\" }],\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const val = getInput(\"in\") ?? false;\r\n      setOutput(\"out\", !val);\r\n    },\r\n  });\r\n\r\n  // ===== VALUE NODES =====\r\n  registry.register(\"value/Number\", {\r\n    title: \"Number\",\r\n    size: { w: 140, h: 60 },\r\n    outputs: [{ name: \"value\", portType: \"data\", datatype: \"number\" }],\r\n    onCreate(node) {\r\n      node.state.value = 0;\r\n    },\r\n    onExecute(node, { setOutput }) {\r\n      console.log(\"[Number] Outputting value:\", node.state.value ?? 0);\r\n      setOutput(\"value\", node.state.value ?? 0);\r\n    },\r\n    html: {\r\n      init(node, el, { header, body }) {\r\n        el.style.backgroundColor = \"#1e1e24\";\r\n        el.style.border = \"1px solid #444\";\r\n        el.style.borderRadius = \"8px\";\r\n\r\n        header.style.backgroundColor = \"#2a2a31\";\r\n        header.style.borderBottom = \"1px solid #444\";\r\n        header.style.color = \"#eee\";\r\n        header.style.fontSize = \"12px\";\r\n        header.textContent = \"Number\";\r\n\r\n        body.style.padding = \"12px\";\r\n        body.style.display = \"flex\";\r\n        body.style.alignItems = \"center\";\r\n        body.style.justifyContent = \"center\";\r\n\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"number\";\r\n        input.value = node.state.value ?? 0;\r\n        Object.assign(input.style, {\r\n          width: \"100%\",\r\n          padding: \"6px\",\r\n          background: \"#141417\",\r\n          border: \"1px solid #444\",\r\n          borderRadius: \"4px\",\r\n          color: \"#fff\",\r\n          fontSize: \"14px\",\r\n          textAlign: \"center\",\r\n          pointerEvents: \"auto\",\r\n        });\r\n\r\n        input.addEventListener(\"change\", (e) => {\r\n          node.state.value = parseFloat(e.target.value) || 0;\r\n        });\r\n\r\n        input.addEventListener(\"mousedown\", (e) => e.stopPropagation());\r\n        input.addEventListener(\"keydown\", (e) => e.stopPropagation());\r\n\r\n        body.appendChild(input);\r\n      },\r\n      update(node, el, { header, body, selected }) {\r\n        el.style.borderColor = selected ? \"#6cf\" : \"#444\";\r\n        header.style.backgroundColor = selected ? \"#3a4a5a\" : \"#2a2a31\";\r\n      },\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const { x, y } = node.computed;\r\n      ctx.fillStyle = \"#8f8\";\r\n      ctx.font = \"14px sans-serif\";\r\n      ctx.textAlign = \"center\";\r\n      ctx.fillText(String(node.state.value ?? 0), x + 70, y + 42);\r\n    },\r\n  });\r\n\r\n  registry.register(\"value/String\", {\r\n    title: \"String\",\r\n    size: { w: 160, h: 60 },\r\n    outputs: [{ name: \"value\", datatype: \"string\" }],\r\n    onCreate(node) {\r\n      node.state.value = \"Hello\";\r\n    },\r\n    onExecute(node, { setOutput }) {\r\n      setOutput(\"value\", node.state.value ?? \"\");\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const { x, y } = node.computed;\r\n      ctx.fillStyle = \"#8f8\";\r\n      ctx.font = \"12px sans-serif\";\r\n      ctx.textAlign = \"center\";\r\n      const text = String(node.state.value ?? \"\");\r\n      const displayText = text.length > 15 ? text.substring(0, 15) + \"...\" : text;\r\n      ctx.fillText(displayText, x + 80, y + 42);\r\n    },\r\n  });\r\n\r\n  registry.register(\"value/Boolean\", {\r\n    title: \"Boolean\",\r\n    size: { w: 140, h: 60 },\r\n    outputs: [{ name: \"value\", portType: \"data\", datatype: \"boolean\" }],\r\n    onCreate(node) {\r\n      node.state.value = true;\r\n    },\r\n    onExecute(node, { setOutput }) {\r\n      console.log(\"[Boolean] Outputting value:\", node.state.value ?? false);\r\n      setOutput(\"value\", node.state.value ?? false);\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const { x, y } = node.computed;\r\n      ctx.fillStyle = node.state.value ? \"#8f8\" : \"#f88\";\r\n      ctx.font = \"14px sans-serif\";\r\n      ctx.textAlign = \"center\";\r\n      ctx.fillText(String(node.state.value), x + 70, y + 42);\r\n    },\r\n  });\r\n\r\n  // ===== UTILITY NODES =====\r\n  registry.register(\"util/Print\", {\r\n    title: \"Print\",\r\n    size: { w: 140, h: 80 },\r\n    inputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"value\", portType: \"data\", datatype: \"any\" },\r\n    ],\r\n    onCreate(node) {\r\n      node.state.lastValue = null;\r\n    },\r\n    onExecute(node, { getInput }) {\r\n      const val = getInput(\"value\");\r\n      if (val !== node.state.lastValue) {\r\n        console.log(\"[Print]\", val);\r\n        node.state.lastValue = val;\r\n      }\r\n    },\r\n  });\r\n\r\n  registry.register(\"util/Watch\", {\r\n    title: \"Watch\",\r\n    size: { w: 180, h: 110 },\r\n    inputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"value\", portType: \"data\", datatype: \"any\" },\r\n    ],\r\n    outputs: [\r\n      { name: \"exec\", portType: \"exec\" },\r\n      { name: \"value\", portType: \"data\", datatype: \"any\" },\r\n    ],\r\n    onCreate(node) {\r\n      node.state.displayValue = \"---\";\r\n    },\r\n    onExecute(node, { getInput, setOutput }) {\r\n      const val = getInput(\"value\");\r\n      console.log(\"[Watch] onExecute called, value:\", val);\r\n      node.state.displayValue = String(val ?? \"---\");\r\n      setOutput(\"value\", val);\r\n    },\r\n    onDraw(node, { ctx, theme }) {\r\n      const { x, y } = node.computed;\r\n      ctx.fillStyle = \"#fa3\";\r\n      ctx.font = \"11px monospace\";\r\n      ctx.textAlign = \"left\";\r\n      const text = String(node.state.displayValue ?? \"---\");\r\n      const displayText = text.length > 20 ? text.substring(0, 20) + \"...\" : text;\r\n      ctx.fillText(displayText, x + 8, y + 50);\r\n    },\r\n  });\r\n\r\n  registry.register(\"util/Timer\", {\r\n    title: \"Timer\",\r\n    size: { w: 140, h: 60 },\r\n    outputs: [{ name: \"time\", datatype: \"number\" }],\r\n    onCreate(node) {\r\n      node.state.startTime = performance.now();\r\n    },\r\n    onExecute(node, { setOutput }) {\r\n      const elapsed = (performance.now() - (node.state.startTime ?? 0)) / 1000;\r\n      setOutput(\"time\", elapsed.toFixed(2));\r\n    },\r\n  });\r\n\r\n  // Trigger Node with Button (HTML Overlay)\r\n  registry.register(\"util/Trigger\", {\r\n    title: \"Trigger\",\r\n    size: { w: 140, h: 80 },\r\n    outputs: [{ name: \"exec\", portType: \"exec\" }], // Changed to exec port\r\n\r\n    html: {\r\n      init(node, el, { header, body }) {\r\n        el.style.backgroundColor = \"#1e1e24\";\r\n        el.style.border = \"1px solid #444\";\r\n        el.style.borderRadius = \"8px\";\r\n\r\n        header.style.backgroundColor = \"#2a2a31\";\r\n        header.style.borderBottom = \"1px solid #444\";\r\n        header.style.color = \"#eee\";\r\n        header.style.fontSize = \"12px\";\r\n        header.textContent = \"Trigger\";\r\n\r\n        body.style.padding = \"12px\";\r\n        body.style.display = \"flex\";\r\n        body.style.alignItems = \"center\";\r\n        body.style.justifyContent = \"center\";\r\n\r\n        const button = document.createElement(\"button\");\r\n        button.textContent = \"Fire!\";\r\n        Object.assign(button.style, {\r\n          padding: \"8px 16px\",\r\n          background: \"#4a9eff\",\r\n          border: \"none\",\r\n          borderRadius: \"4px\",\r\n          color: \"#fff\",\r\n          fontWeight: \"bold\",\r\n          cursor: \"pointer\",\r\n          pointerEvents: \"auto\",\r\n          transition: \"background 0.2s\",\r\n        });\r\n\r\n        button.addEventListener(\"mousedown\", (e) => {\r\n          e.stopPropagation();\r\n          button.style.background = \"#2a7ede\";\r\n        });\r\n\r\n        button.addEventListener(\"mouseup\", () => {\r\n          button.style.background = \"#4a9eff\";\r\n        });\r\n\r\n        button.addEventListener(\"click\", (e) => {\r\n          e.stopPropagation();\r\n          node.state.triggered = true;\r\n          console.log(\"[Trigger] Button clicked!\");\r\n\r\n          // Use runner.runOnce for connected node execution\r\n          if (node.__runnerRef && node.__controllerRef) {\r\n            console.log(\"[Trigger] Runner and controller found\");\r\n            const runner = node.__runnerRef;\r\n            const controller = node.__controllerRef;\r\n            const graph = controller.graph;\r\n            console.log(\"[Trigger] Calling runner.runOnce with node.id:\", node.id);\r\n\r\n            // Execute connected nodes using runner\r\n            const result = runner.runOnce(node.id, 0);\r\n            const connectedEdges = result.connectedEdges;\r\n\r\n\r\n\r\n            // Show animation with manual rendering\r\n            const startTime = performance.now();\r\n            const animationDuration = 500;\r\n\r\n            const animate = () => {\r\n              const elapsed = performance.now() - startTime;\r\n              if (elapsed < animationDuration) {\r\n                controller.renderer.draw(graph, {\r\n                  selection: controller.selection,\r\n                  tempEdge: null,\r\n                  running: true,\r\n                  time: performance.now(),\r\n                  dt: 0,\r\n                  activeEdges: connectedEdges, // Only animate connected edges\r\n                });\r\n                controller.htmlOverlay?.draw(graph, controller.selection);\r\n                requestAnimationFrame(animate);\r\n              } else {\r\n                controller.render();\r\n                node.state.triggered = false;\r\n              }\r\n            };\r\n\r\n            animate();\r\n          }\r\n        });\r\n\r\n        body.appendChild(button);\r\n      },\r\n\r\n      update(node, el, { header, body, selected }) {\r\n        el.style.borderColor = selected ? \"#6cf\" : \"#444\";\r\n        header.style.backgroundColor = selected ? \"#3a4a5a\" : \"#2a2a31\";\r\n      },\r\n    },\r\n\r\n    onCreate(node) {\r\n      node.state.triggered = false;\r\n    },\r\n\r\n    onExecute(node, { setOutput }) {\r\n      console.log(\"[Trigger] Outputting triggered:\", node.state.triggered);\r\n      setOutput(\"triggered\", node.state.triggered);\r\n    },\r\n  });\r\n\r\n  // Group Node\r\n  registry.register(\"core/Group\", {\r\n    title: \"Group\",\r\n    size: { w: 240, h: 160 },\r\n    onDraw(node, { ctx, theme }) {\r\n      const { x, y, w, h } = node.computed;\r\n      const headerH = 24;\r\n      const color = node.state.color || \"#39424e\";\r\n      const bgAlpha = 0.5;\r\n      const textColor = theme.text || \"#e9e9ef\";\r\n\r\n      // Helper for rgba\r\n      const rgba = (hex, a) => {\r\n        const c = hex.replace(\"#\", \"\");\r\n        const n = parseInt(\r\n          c.length === 3\r\n            ? c\r\n              .split(\"\")\r\n              .map((x) => x + x)\r\n              .join(\"\")\r\n            : c,\r\n          16\r\n        );\r\n        const r = (n >> 16) & 255,\r\n          g = (n >> 8) & 255,\r\n          b = n & 255;\r\n        return `rgba(${r},${g},${b},${a})`;\r\n      };\r\n\r\n      // Helper for roundRect\r\n      const roundRect = (ctx, x, y, w, h, r) => {\r\n        if (w < 2 * r) r = w / 2;\r\n        if (h < 2 * r) r = h / 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x + r, y);\r\n        ctx.arcTo(x + w, y, x + w, y + h, r);\r\n        ctx.arcTo(x + w, y + h, x, y + h, r);\r\n        ctx.arcTo(x, y + h, x, y, r);\r\n        ctx.arcTo(x, y, x + w, y, r);\r\n        ctx.closePath();\r\n      };\r\n\r\n      // Body\r\n      ctx.fillStyle = rgba(color, bgAlpha);\r\n      roundRect(ctx, x, y, w, h, 10);\r\n      ctx.fill();\r\n\r\n      // Header bar (subtle)\r\n      ctx.fillStyle = rgba(color, 0.3);\r\n      ctx.beginPath();\r\n      ctx.roundRect(x, y, w, headerH, [10, 10, 0, 0]);\r\n      ctx.fill();\r\n\r\n      // Title - top left with better styling\r\n      ctx.fillStyle = textColor;\r\n      ctx.font = \"600 13px system-ui\";\r\n      ctx.textBaseline = \"top\";\r\n      ctx.fillText(node.title, x + 12, y + 6);\r\n    },\r\n  });\r\n\r\n  /**\r\n  * Setup default context menu items\r\n  * This function can be customized or replaced by users\r\n  */\r\n  function setupDefaultContextMenu(contextMenu, { controller, graph, hooks }) {\r\n    // Add Node submenu (canvas background only)\r\n    const nodeTypes = [];\r\n    for (const [key, typeDef] of graph.registry.types.entries()) {\r\n      nodeTypes.push({\r\n        id: `add-${key}`,\r\n        label: typeDef.title || key,\r\n        action: () => {\r\n          // Get world position from context menu\r\n          const worldPos = contextMenu.worldPosition || { x: 100, y: 100 };\r\n\r\n          // Add node at click position\r\n          const node = graph.addNode(key, {\r\n            x: worldPos.x,\r\n            y: worldPos.y,\r\n          });\r\n\r\n          hooks?.emit(\"node:updated\", node);\r\n          controller.render(); // Update minimap and canvas\r\n        },\r\n      });\r\n    }\r\n\r\n    contextMenu.addItem(\"add-node\", \"Add Node\", {\r\n      condition: (target) => !target,\r\n      submenu: nodeTypes,\r\n      order: 5,\r\n    });\r\n\r\n    // Delete Node (for all nodes except groups)\r\n    contextMenu.addItem(\"delete-node\", \"Delete Node\", {\r\n      condition: (target) => target && target.type !== \"core/Group\",\r\n      action: (target) => {\r\n        const cmd = RemoveNodeCmd(graph, target);\r\n        controller.stack.exec(cmd);\r\n        hooks?.emit(\"node:updated\", target);\r\n      },\r\n      order: 10,\r\n    });\r\n\r\n    // Change Group Color (for groups only) - with submenu\r\n    const colors = [\r\n      { name: \"Default\", color: \"#39424e\" },\r\n      { name: \"Slate\", color: \"#4a5568\" },\r\n      { name: \"Gray\", color: \"#2d3748\" },\r\n      { name: \"Blue\", color: \"#1a365d\" },\r\n      { name: \"Green\", color: \"#22543d\" },\r\n      { name: \"Red\", color: \"#742a2a\" },\r\n      { name: \"Purple\", color: \"#44337a\" },\r\n    ];\r\n\r\n    contextMenu.addItem(\"change-group-color\", \"Change Color\", {\r\n      condition: (target) => target && target.type === \"core/Group\",\r\n      submenu: colors.map((colorInfo) => ({\r\n        id: `color-${colorInfo.color}`,\r\n        label: colorInfo.name,\r\n        color: colorInfo.color,\r\n        action: (target) => {\r\n          const currentColor = target.state.color || \"#39424e\";\r\n          const cmd = ChangeGroupColorCmd(target, currentColor, colorInfo.color);\r\n          controller.stack.exec(cmd);\r\n          hooks?.emit(\"node:updated\", target);\r\n        },\r\n      })),\r\n      order: 20,\r\n    });\r\n    contextMenu.addItem(\"delete-group\", \"Delete Group\", {\r\n      condition: (target) => target && target.type === \"core/Group\",\r\n      action: (target) => {\r\n        const cmd = RemoveNodeCmd(graph, target);\r\n        controller.stack.exec(cmd);\r\n        hooks?.emit(\"node:updated\", target);\r\n      },\r\n      order: 20,\r\n    });\r\n  }\r\n\r\n\r\n  // Setup default context menu items\r\n  // Users can easily override, remove, or add items here\r\n  setupDefaultContextMenu(contextMenu, { controller, graph, hooks });\r\n\r\n  // initial render & resize\r\n  renderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n  portRenderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n  controller.render();\r\n\r\n  const ro = new ResizeObserver(() => {\r\n    renderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n    portRenderer.resize(canvas.clientWidth, canvas.clientHeight);\r\n    controller.render();\r\n  });\r\n  ro.observe(canvas);\r\n\r\n  // Wrap controller.render to update minimap\r\n  const originalRender = controller.render.bind(controller);\r\n  controller.render = function () {\r\n    originalRender();\r\n    if (minimap) {\r\n      minimap.render();\r\n    }\r\n  };\r\n\r\n  const api = {\r\n    addGroup: (args = {}) => {\r\n      controller.graph.groupManager.addGroup(args);\r\n      controller.render();\r\n    },\r\n    graph,\r\n    renderer,\r\n    controller, // Expose controller for snap-to-grid access\r\n    runner, // Expose runner for trigger\r\n    minimap, // Expose minimap\r\n    contextMenu,\r\n    hooks, // Expose hooks for event handling\r\n    registry, // Expose registry for node types\r\n    htmlOverlay, // Expose htmlOverlay for clearing/resetting\r\n    propertyPanel, // Expose propertyPanel\r\n    render: () => controller.render(),\r\n    start: () => runner.start(),\r\n    stop: () => runner.stop(),\r\n    destroy: () => {\r\n      runner.stop();\r\n      ro.disconnect();\r\n      controller.destroy();\r\n      htmlOverlay.destroy();\r\n      contextMenu.destroy();\r\n      if (propertyPanel) propertyPanel.destroy();\r\n      if (minimap) minimap.destroy();\r\n    },\r\n  };\r\n\r\n  if (autorun) runner.start();\r\n  return api;\r\n}\r\n"],"names":["bytes","hex","_a","w","_b","theme","runner","controller","graph","x","roundRect","ctx","y","h","contextMenu","hooks","target"],"mappings":"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"}